# åŠ›æ‰£ã€ç¬¬ 315 é¢˜ï¼šè®¡ç®—å³ä¾§å°äºå½“å‰å…ƒç´ çš„ä¸ªæ•°

| é¢˜ç›®åœ°å€                                                     | é¢˜è§£                                                         |
| :----------------------------------------------------------- | :----------------------------------------------------------- |
| [LeetCode ç¬¬ 315 é¢˜ï¼šè®¡ç®—å³ä¾§å°äºå½“å‰å…ƒç´ çš„ä¸ªæ•°](https://leetcode-cn.com/problems/count-of-smaller-numbers-after-self/) | [å½’å¹¶æ’åº + ç´¢å¼•æ•°ç»„ï¼ˆPython ä»£ç ã€Java ä»£ç ï¼‰](https://leetcode-cn.com/problems/count-of-smaller-numbers-after-self/solution/gui-bing-pai-xu-suo-yin-shu-zu-python-dai-ma-java-/) |

### å½’å¹¶æ’åºï¼ˆç´¢å¼•æ•°ç»„ï¼‰

å¦‚æœæœ‰å­¦ä¹ è¿‡ä¸€ä¸ªæ•°ç»„çš„â€œé€†åºå¯¹â€å¦‚ä½•è®¡ç®—çš„æœ‹å‹ï¼Œå¯¹æ±‚è§£è¿™é“é—®é¢˜åº”è¯¥ä¸é™Œç”Ÿã€‚æ±‚è§£â€œé€†åºå¯¹â€çš„å…³é”®åœ¨äºï¼š**å½“å…¶ä¸­ä¸€ä¸ªæ•°å­—æ”¾è¿›æœ€ç»ˆå½’å¹¶ä»¥åçš„æœ‰åºæ•°ç»„ä¸­çš„æ—¶å€™ï¼Œè¿™ä¸ªæ•°å­—ä¸ä¹‹å‰çœ‹è¿‡çš„æ•°å­—ä¸ªæ•°ï¼ˆæˆ–è€…æ˜¯æœªçœ‹è¿‡çš„æ•°å­—ä¸ªæ•°ï¼‰å¯ä»¥ç›´æ¥ç»Ÿè®¡å‡ºæ¥ï¼Œè€Œä¸å¿…ä¸€ä¸ªä¸€ä¸ªæ•°â€**ã€‚



![LeetCode ç¬¬ 315 é¢˜-1](https://liweiwei1419.gitee.io/images/leetcode-solution/315-1.png)

**LeetCode ç¬¬ 315 é¢˜-1**



â€œå½’å¹¶æ’åºâ€å®Œæˆä»¥åï¼ŒåŸæ•°ç»„çš„â€œé€†åºæ•°â€ä¹Ÿæ•°å‡ºæ¥äº†ã€‚

**ä¸‹é¢è¿™å¥è¯å¾ˆé‡è¦**ï¼š

> å›åˆ°æœ¬é¢˜ï¼Œæœ¬é¢˜è®©æˆ‘ä»¬æ±‚â€œåœ¨ä¸€ä¸ªæ•°ç»„çš„æŸä¸ªå…ƒç´ çš„å³è¾¹ï¼Œæ¯”è‡ªå·±å°çš„å…ƒç´ çš„ä¸ªæ•°â€ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å°±åº”è¯¥åœ¨â€œå‰æœ‰åºæ•°ç»„â€çš„å…ƒç´ å‡ºåˆ—çš„æ—¶å€™ï¼Œæ•°ä¸€æ•°â€œåæœ‰åºæ•°ç»„â€å·²ç»å‡ºåˆ—äº†å¤šå°‘å…ƒç´ ï¼Œå› ä¸ºè¿™äº›å·²ç»å‡ºåˆ—çš„å…ƒç´ éƒ½æ¯”å½“å‰å‡ºåˆ—çš„å…ƒç´ è¦å°ï¼ˆæˆ–è€…ç­‰äºï¼‰ã€‚

**å‘ç°é—®é¢˜**

ä¸è¿‡é¢˜ç›®ä¸­è¦æ±‚æˆ‘ä»¬è¦å…·ä½“è®¡ç®—åˆ°å…ƒç´ çº§åˆ«ã€‚â€œå½’å¹¶æ’åºâ€å®Œæˆä»¥åï¼ŒåŸå§‹æ•°ç»„çš„ä½ç½®å°±å·²ç»å˜åŒ–äº†ï¼Œå› æ­¤å¦‚ä½•å®šä½å…ƒç´ æ˜¯å…³é”®ã€‚

**æƒ³ä¸€æƒ³è¿™ä¸€åˆ—é—®é¢˜æ˜¯æ€ä¹ˆè§£å†³çš„**

**ä¸€ä¸ªå…ƒç´ åœ¨ç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ä½ç½®å‘ç”Ÿå˜åŒ–ï¼Œæˆ‘ä»¬è¿˜æƒ³å®šä½å®ƒ**ï¼Œè¿™æ ·çš„åœºæ™¯æˆ‘ä»¬åœ¨â€œæœ€å°ç´¢å¼•å †â€ä¸­æ›¾ç»å­¦ä¹ è¿‡ï¼Œä»ä¸­å¾—åˆ°å¯å‘ï¼Œä¸å¦¨ä¹Ÿè®¾ç½®ä¸€ä¸ªâ€œç´¢å¼•æ•°ç»„â€å§ã€‚ä½¿ç”¨â€œç´¢å¼•æ•°ç»„â€çš„å…³é”®åœ¨äºï¼š

> **â€œåŸå§‹æ•°ç»„â€ä¸å˜ï¼Œç”¨äºæ¯”è¾ƒä¸¤ä¸ªå…ƒç´ çš„å¤§å°ï¼ŒçœŸæ­£ä½ç½®å˜æ¢çš„æ˜¯â€œç´¢å¼•æ•°ç»„â€**ã€‚

ä¸‹é¢æˆ‘å°è¯•è§£é‡Šä¸€ä¸‹â€œç´¢å¼•æ•°ç»„â€çš„ä½¿ç”¨æ–¹æ³•ï¼š



![LeetCode ç¬¬ 315 é¢˜-2](https://liweiwei1419.github.io/images/leetcode-solution/315-2.png)

**LeetCode ç¬¬ 315 é¢˜-2**



ä¸ºäº†å®Œæˆâ€œç´¢å¼•æ•°ç»„â€çš„å½’å¹¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªâ€œç´¢å¼•æ•°ç»„â€é•¿åº¦çš„ä¸´æ—¶æ•°ç»„ï¼ŒæŠŠç´¢å¼•æ•°ç»„çš„å€¼å¤åˆ¶è¿‡å»ï¼Œæ¯”è¾ƒå®Œæˆä»¥åï¼Œå†èµ‹å€¼å›â€œç´¢å¼•æ•°ç»„â€ã€‚å…·ä½“è¯·çœ‹ä¸‹é¢çš„ä»£ç ã€‚

**ç¼–ç æ³¨æ„äº‹é¡¹**

ä¸€ã€å¯ä»¥å¤ä¹ ä¸€ä¸‹â€œå½’å¹¶æ’åºâ€çš„ç»†èŠ‚ã€‚

1ã€å¦‚æœâ€œå‰æœ‰åºæ•°ç»„â€å’Œâ€œåæœ‰åºæ•°ç»„â€ç›´æ¥åˆå¹¶çš„æ—¶å€™ï¼Œå°±æœ‰åºï¼Œå°±ä¸å¿…å½’å¹¶ï¼›
2ã€åœ¨â€œå½’å¹¶â€çš„æ—¶å€™ï¼Œå…¨å±€ä½¿ç”¨ä¸€ä¸ªä¸´æ—¶å­˜å‚¨æ•°ç»„ï¼Œè€Œä¸å¿…æ¯ä¸€ä¸ªå½’å¹¶éƒ½æ–°å»ºä¸´æ—¶çš„å­˜å‚¨ç©ºé—´ã€‚

äºŒã€å‡ºåˆ—ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œé©¬ä¸Šå¾—åˆ°å³è¾¹æ¯”è‡ªå·±å°çš„å…ƒç´ çš„ä¸ªæ•°ï¼Œæ˜¯é€šè¿‡ä¸åŒçš„æŒ‡é’ˆä¹‹é—´çš„è·ç¦»å¾—åˆ°çš„ã€‚

**åœ¨ç¼–ç çš„æ—¶å€™ï¼Œå»ºè®®åœ¨è‰ç¨¿çº¸ä¸Šå†™å†™ç”»ç”»ï¼Œç”¨å…·ä½“çš„æ•°å€¼å¸¦è¿›å»ï¼Œæ‰èƒ½ç¡®ä¿ä½ è®¡ç®—çš„æŒ‡é’ˆä¹‹é—´çš„è·ç¦»æ­£ç¡®**ã€‚ä¾‹å¦‚æˆ‘å†™çš„ Python ä»£ç  `res[indexes[i]] += (right - mid)` å’Œ `res[indexes[i]] += (r - mid - 1)` è¿™ä¸¤å¥ä»£ç çš„è®¡ç®—ï¼Œæˆ‘å°±æ˜¯åœ¨è‰ç¨¿çº¸ä¸Šç”»å‡ºæ¥çš„ã€‚

ä¸‰ã€å¦‚æœä½ å†™è¿‡â€œé€†åºæ•°â€çš„è®¡ç®—çš„ä»£ç ï¼Œä½ å°±ä¼šå‘ç°ï¼Œâ€œé€†åºæ•°â€çš„è®¡ç®—å¯ä»¥åœ¨â€œå‰æœ‰åºæ•°ç»„â€å…ƒç´ å‡ºåˆ—çš„æ—¶å€™è®¡ç®—é€†åºæ•°ï¼Œä¹Ÿå¯ä»¥åœ¨â€œåæœ‰åºæ•°ç»„â€å…ƒç´ å‡ºåˆ—çš„æ—¶å€™è®¡ç®—é€†åºæ•°ï¼Œä½ å¯ä»¥æ¯”è¾ƒä¸€ä¸‹å®ƒä»¬åœ¨ç¼–ç æ—¶å€™çš„ä¸åŒä¹‹å¤„ã€‚ä¸‹é¢æ˜¯æˆ‘å†™â€œé€†åºæ•°â€çš„è®¡ç®—ä»£ç å†™çš„è‰ç¨¿ã€‚



![LeetCode ç¬¬ 315 é¢˜-3](https://liweiwei1419.github.io/images/leetcode-solution/315-3.png)

**LeetCode ç¬¬ 315 é¢˜-3**



å‚è€ƒä»£ç ï¼š

Python ä»£ç ï¼š

Python

```Python
class Solution:
    def countSmaller(self, nums):
        size = len(nums)
        if size == 0:
            return []
        if size == 1:
            return [0]

        temp = [None for _ in range(size)]
        indexes = [i for i in range(size)]
        res = [0 for _ in range(size)]

        self.__helper(nums, 0, size - 1, temp, indexes, res)
        return res

    def __helper(self, nums, left, right, temp, indexes, res):
        if left == right:
            return
        mid = left + (right - left) // 2

        # è®¡ç®—ä¸€ä¸‹å·¦è¾¹
        self.__helper(nums, left, mid, temp, indexes, res)
        # è®¡ç®—ä¸€ä¸‹å³è¾¹
        self.__helper(nums, mid + 1, right, temp, indexes, res)

        if nums[indexes[mid]] <= nums[indexes[mid + 1]]:
            return
        self.__sort_and_count_smaller(nums, left, mid, right, temp, indexes, res)

    def __sort_and_count_smaller(self, nums, left, mid, right, temp, indexes, res):
        # [left,mid] å‰æœ‰åºæ•°ç»„
        # [mid+1,right] åæœ‰åºæ•°ç»„

        # å…ˆæ‹·è´ï¼Œå†åˆå¹¶

        for i in range(left, right + 1):
            temp[i] = indexes[i]

        l = left
        r = mid + 1
        for i in range(left, right + 1):
            if l > mid:
                # l ç”¨å®Œï¼Œå°±æ‹¼å‘½ä½¿ç”¨ r
                # [1,2,3,4] [5,6,7,8]
                indexes[i] = temp[r]
                r += 1
            elif r > right:
                # r ç”¨å®Œï¼Œå°±æ‹¼å‘½ä½¿ç”¨ l
                # [6,7,8,9] [1,2,3,4]
                indexes[i] = temp[l]
                l += 1
                # æ³¨æ„ï¼šæ­¤æ—¶å‰é¢å‰©ä¸‹çš„æ•°ï¼Œæ¯”åé¢æ‰€æœ‰çš„æ•°éƒ½å¤§
                res[indexes[i]] += (right - mid)
            elif nums[temp[l]] <= nums[temp[r]]:
                # [3,5,7,9] [4,6,8,10]
                indexes[i] = temp[l]
                l += 1
                # æ³¨æ„ï¼š
                res[indexes[i]] += (r - mid - 1)
            else:
                assert nums[temp[l]] > nums[temp[r]]
                # ä¸Šé¢ä¸¤ç§æƒ…å†µåªåœ¨å…¶ä¸­ä¸€ç§ç»Ÿè®¡å°±å¯ä»¥äº†
                # [3,5,7,9] [4,6,8,10]
                indexes[i] = temp[r]
                r += 1
```

Java ä»£ç ï¼š

Java

```Java
import java.util.ArrayList;
import java.util.List;

public class Solution {

    private int[] temp;
    private int[] counter;
    private int[] indexes;

    public List countSmaller(int[] nums) {
        List res = new ArrayList<>();
        int len = nums.length;
        if (len == 0) {
            return res;
        }
        temp = new int[len];
        counter = new int[len];
        indexes = new int[len];
        for (int i = 0; i < len; i++) {
            indexes[i] = i;
        }
        mergeAndCountSmaller(nums, 0, len - 1);
        for (int i = 0; i < len; i++) {
            res.add(counter[i]);
        }
        return res;
    }

    /**
     * é’ˆå¯¹æ•°ç»„ nums æŒ‡å®šçš„åŒºé—´ [l, r] è¿›è¡Œå½’å¹¶æ’åºï¼Œåœ¨æ’åºçš„è¿‡ç¨‹ä¸­å®Œæˆç»Ÿè®¡ä»»åŠ¡
     *
     * @param nums
     * @param l
     * @param r
     */
    private void mergeAndCountSmaller(int[] nums, int l, int r) {
        if (l == r) {
            // æ•°ç»„åªæœ‰ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œæ²¡æœ‰æ¯”è¾ƒï¼Œä¸ç»Ÿè®¡
            return;
        }
        int mid = l + (r - l) / 2;
        mergeAndCountSmaller(nums, l, mid);
        mergeAndCountSmaller(nums, mid + 1, r);
        // å½’å¹¶æ’åºçš„ä¼˜åŒ–ï¼ŒåŒæ ·é€‚ç”¨äºè¯¥é—®é¢˜
        // å¦‚æœç´¢å¼•æ•°ç»„æœ‰åºï¼Œå°±æ²¡æœ‰å¿…è¦å†ç»§ç»­è®¡ç®—äº†
        if (nums[indexes[mid]] > nums[indexes[mid + 1]]) {
            mergeOfTwoSortedArrAndCountSmaller(nums, l, mid, r);
        }
    }

    /**
     * [l, mid] æ˜¯æ’å¥½åºçš„
     * [mid + 1, r] æ˜¯æ’å¥½åºçš„
     *
     * @param nums
     * @param l
     * @param mid
     * @param r
     */
    private void mergeOfTwoSortedArrAndCountSmaller(int[] nums, int l, int mid, int r) {
        // 3,4  1,2
        for (int i = l; i <= r; i++) {
            temp[i] = indexes[i];
        }
        int i = l;
        int j = mid + 1;
        // å·¦è¾¹å‡ºåˆ—çš„æ—¶å€™ï¼Œè®¡æ•°
        for (int k = l; k <= r; k++) {
            if (i > mid) {
                indexes[k] = temp[j];
                j++;
            } else if (j > r) {
                indexes[k] = temp[i];
                i++;
                // æ­¤æ—¶ j ç”¨å®Œäº†ï¼Œ[7,8,9 | 1,2,3]
                // ä¹‹å‰çš„æ•°å°±å’Œåé¢çš„åŒºé—´é•¿åº¦æ„æˆé€†åº
                counter[indexes[k]] += (r - mid);
            } else if (nums[temp[i]] <= nums[temp[j]]) {
                indexes[k] = temp[i];
                i++;
                // æ­¤æ—¶ [4,5, 6   | 1,2,3 10 12 13]
                //           mid          j
                counter[indexes[k]] += (j - mid - 1);
            } else {
                // nums[indexes[i]] > nums[indexes[j]] æ„æˆé€†åº
                indexes[k] = temp[j];
                j++;
            }
        }
    }

    public static void main(String[] args) {
        int[] nums = new int[]{5, 2, 6, 1};
        Solution solution = new Solution();
        List countSmaller = solution.countSmaller(nums);
        System.out.println(countSmaller);
    }
}
```

**å¤æ‚åº¦åˆ†æï¼š**

- æ—¶é—´å¤æ‚åº¦ï¼šğ‘‚(ğ‘logğ‘)O(Nlogâ¡N)ï¼Œæ•°ç»„çš„å…ƒç´ ä¸ªæ•°æ˜¯ ğ‘Nï¼Œé€’å½’æ‰§è¡Œåˆ†æ²»æ³•ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯å¯¹æ•°çº§åˆ«çš„ï¼Œå› æ­¤æ—¶é—´å¤æ‚åº¦æ˜¯ ğ‘‚(ğ‘logğ‘)O(Nlogâ¡N)ã€‚
- ç©ºé—´å¤æ‚åº¦ï¼šğ‘‚(ğ‘)O(N)ï¼Œéœ€è¦ 33 ä¸ªæ•°ç»„ï¼Œä¸€ä¸ªç´¢å¼•æ•°ç»„ï¼Œä¸€ä¸ªä¸´æ—¶æ•°ç»„ç”¨äºç´¢å¼•æ•°ç»„çš„å½’å¹¶ï¼Œè¿˜æœ‰ä¸€ä¸ªç»“æœæ•°ç»„ï¼Œå®ƒä»¬çš„é•¿åº¦éƒ½æ˜¯ ğ‘Nï¼Œæ•…ç©ºé—´å¤æ‚åº¦æ˜¯ ğ‘‚(ğ‘)O(N)ã€‚

# LeetCode ç¬¬ 315 é¢˜ï¼šâ€œè®¡ç®—å³ä¾§å°äºå½“å‰å…ƒç´ çš„ä¸ªæ•°â€é¢˜è§£

é¢˜è§£åœ°å€ï¼š[å½’å¹¶æ’åº + ç´¢å¼•æ•°ç»„](https://leetcode-cn.com/problems/count-of-smaller-numbers-after-self/solution/gui-bing-pai-xu-suo-yin-shu-zu-python-dai-ma-java-/)ã€‚

è¯´æ˜ï¼šæ–‡æœ¬é¦–å‘åœ¨åŠ›æ‰£çš„é¢˜è§£ç‰ˆå—ï¼Œæ›´æ–°ä¹Ÿä¼šåœ¨ç¬¬ 1 æ—¶é—´åœ¨ä¸Šé¢çš„ç½‘ç«™ä¸­æ›´æ–°ï¼Œè¿™ç¯‡æ–‡ç« åªæ˜¯ä¸Šé¢çš„æ–‡ç« çš„ä¸€ä¸ªå¿«ç…§ï¼Œæ‚¨å¯ä»¥ç‚¹å‡»ä¸Šé¢çš„é“¾æ¥çœ‹åˆ°å…¶ä»–ç½‘å‹å¯¹æœ¬æ–‡çš„è¯„è®ºã€‚

ä¼ é€é—¨ï¼š[è®¡ç®—å³ä¾§å°äºå½“å‰å…ƒç´ çš„ä¸ªæ•°](https://leetcode-cn.com/problems/count-of-smaller-numbers-after-self/)ã€‚

> ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ numsï¼ŒæŒ‰è¦æ±‚è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ countsã€‚æ•°ç»„ counts æœ‰è¯¥æ€§è´¨ï¼š counts[i] çš„å€¼æ˜¯ nums[i] å³ä¾§å°äº nums[i] çš„å…ƒç´ çš„æ•°é‡ã€‚
>
> ç¤ºä¾‹:
>
> è¾“å…¥: [5,2,6,1]
> è¾“å‡º: [2,1,1,0]
> è§£é‡Š:
> 5 çš„å³ä¾§æœ‰ 2 ä¸ªæ›´å°çš„å…ƒç´  2å’Œ12å’Œ1.
> 2 çš„å³ä¾§ä»…æœ‰ 1 ä¸ªæ›´å°çš„å…ƒç´  11.
> 6 çš„å³ä¾§æœ‰ 1 ä¸ªæ›´å°çš„å…ƒç´  11.
> 1 çš„å³ä¾§æœ‰ 0 ä¸ªæ›´å°çš„å…ƒç´ .

## å½’å¹¶æ’åº + ç´¢å¼•æ•°ç»„

### å½’å¹¶æ’åº + ç´¢å¼•æ•°ç»„

å¦‚æœæœ‰å­¦ä¹ è¿‡ä¸€ä¸ªæ•°ç»„çš„â€œé€†åºå¯¹â€å¦‚ä½•è®¡ç®—çš„æœ‹å‹ï¼Œå¯¹æ±‚è§£è¿™é“é—®é¢˜åº”è¯¥ä¸é™Œç”Ÿã€‚



![image.png](https://pic.leetcode-cn.com/a8a8a0cb737e1100766f9b406e141f3cff0918b85c6443071456a34f50faf164-image.png)

**image.png**

),

![image.png](https://pic.leetcode-cn.com/72f9f4e33a03726166812906eb63194dd81a2b02b969d86bfecaff6ca1faf7e3-image.png)

**image.png**

),

![image.png](https://pic.leetcode-cn.com/b4b3251eaed3bbed98a5d8792d694aec4b95c3079d1e36d65581b56b11f10d94-image.png)

**image.png**

),

![image.png](https://pic.leetcode-cn.com/7cdcdc78c3f2f056bf5c7e1fe116de0d1e2066bb8839c44a8b33755389dc63ac-image.png)

**image.png**

),

![image.png](https://pic.leetcode-cn.com/fec652674db89aa8acda91e2ce84203168769f5d6d720797045dcc5865160a01-image.png)

**image.png**

),

![image.png](https://pic.leetcode-cn.com/4b70e0bcf059b3dcbbea7ab46eb22314c65cc2bed74f17ef74a2eb5c0f73090b-image.png)

**image.png**

),

![image.png](https://pic.leetcode-cn.com/2cd9099d60d56edf0c66ff41bdd6859c5327e6b39d4225449bff299c82073635-image.png)

**image.png**

),

![image.png](https://pic.leetcode-cn.com/7babb0fcd83ce8f9b6dd5da2ee187268ad680c26bcc3ca5d6ab96aed4acde679-image.png)

**image.png**

),

![image.png](https://pic.leetcode-cn.com/5de2c79dd9eeec39ceb44ad597a26da192060c29cf9845868243c2b6390f0e06-image.png)

**image.png**

),

![image.png](https://pic.leetcode-cn.com/4e4a67de3359c904345bd27bfc78f0a41f6c438fd6275a8b6f3dc3c3d46abfcd-image.png)

**image.png**

),

![image.png](https://pic.leetcode-cn.com/00082337651ccbf3115aaa5b3f5a66a59d5190c3d9f76f057ad92d44fecc35f3-image.png)

**image.png**

),

![image.png](https://pic.leetcode-cn.com/5e4b3bcdd091e08cee30a8269856ec310d3cec16f784866c59c0e77f9670ad71-image.png)

**image.png**

),

![image.png](https://pic.leetcode-cn.com/e49182d0eae38f0f762f614fed6f52b9f2eca9efd9554bb36bcc21137bdd9d4e-image.png)

**image.png**

),

![image.png](https://pic.leetcode-cn.com/cc9d7b17dbfc5faced0d388271e9e4079e43c8ce5851d33ebe28d94fcacda3cc-image.png)

**image.png**

),

![image.png](https://pic.leetcode-cn.com/9a8f56b50225b81c906d19d8929591fe34f8c1c3eb45966d6c8dd81b22b9450d-image.png)

**image.png**

),

![image.png](https://pic.leetcode-cn.com/7a23dc334b01e693f787d3b3c3d98a685e5b6f48fd02b090985cd291cdc78cf6-image.png)

**image.png**

),

![image.png](https://pic.leetcode-cn.com/5f01a5dd1866e4d728cd395232d1d52451e949030af6085ed76ade6a3c0f562a-image.png)

**image.png**

),

![image.png](https://pic.leetcode-cn.com/b4f55e533b0fcf8166964cfb496c8e25393d4cfefb4dce3714b8806827f9b270-image.png)

**image.png**

),

![image.png](https://pic.leetcode-cn.com/c46a294e23a05d320e6903a932932fecd130bdeb78c718fe9a3b35e34d2f0056-image.png)

**image.png**



æ±‚è§£ â€œé€†åºå¯¹â€ çš„å…³é”®åœ¨äºï¼š**å½“å…¶ä¸­ä¸€ä¸ªæ•°å­—æ”¾è¿›æœ€ç»ˆå½’å¹¶ä»¥åçš„æœ‰åºæ•°ç»„ä¸­çš„æ—¶å€™ï¼Œè¿™ä¸ªæ•°å­—ä¸ä¹‹å‰çœ‹è¿‡çš„æ•°å­—ä¸ªæ•°ï¼ˆæˆ–è€…æ˜¯æœªçœ‹è¿‡çš„æ•°å­—ä¸ªæ•°ï¼‰å¯ä»¥ç›´æ¥ç»Ÿè®¡å‡ºæ¥ï¼Œè€Œä¸å¿…ä¸€ä¸ªä¸€ä¸ªæ•°â€**ã€‚



![315-1.png](https://pic.leetcode-cn.com/729ec13f1387a428a264c143def1ff0e211952fa5c4f22424dbfb760509fa2bc-315-1.png)

**315-1.png**



â€œå½’å¹¶æ’åºâ€ å®Œæˆä»¥åï¼ŒåŸæ•°ç»„çš„ â€œé€†åºæ•°â€ ä¹Ÿæ•°å‡ºæ¥äº†ã€‚

**ä¸‹é¢è¿™å¥è¯å¾ˆé‡è¦**ï¼š

> å›åˆ°æœ¬é¢˜ï¼Œæœ¬é¢˜è®©æˆ‘ä»¬æ±‚ â€œåœ¨ä¸€ä¸ªæ•°ç»„çš„æŸä¸ªå…ƒç´ çš„å³è¾¹ï¼Œæ¯”è‡ªå·±å°çš„å…ƒç´ çš„ä¸ªæ•°â€ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å°± **åº”è¯¥åœ¨ â€œå‰æœ‰åºæ•°ç»„â€ çš„å…ƒç´ å‡ºåˆ—çš„æ—¶å€™ï¼Œæ•°ä¸€æ•° â€œåæœ‰åºæ•°ç»„â€ å·²ç»å‡ºåˆ—äº†å¤šå°‘å…ƒç´ **ï¼Œå› ä¸ºè¿™äº›å·²ç»å‡ºåˆ—çš„å…ƒç´ éƒ½æ¯”å½“å‰å‡ºåˆ—çš„å…ƒç´ è¦å°ï¼ˆæˆ–è€…ç­‰äºï¼‰ã€‚

**å‘ç°é—®é¢˜**

ä¸è¿‡é¢˜ç›®ä¸­è¦æ±‚æˆ‘ä»¬è¦å…·ä½“è®¡ç®—åˆ°å…ƒç´ çº§åˆ«ã€‚â€œå½’å¹¶æ’åºâ€ å®Œæˆä»¥åï¼ŒåŸå§‹æ•°ç»„çš„ä½ç½®å°±å·²ç»å˜åŒ–äº†ï¼Œå› æ­¤å¦‚ä½•å®šä½å…ƒç´ æ˜¯å…³é”®ã€‚

**æƒ³ä¸€æƒ³è¿™ä¸€ç±»é—®é¢˜æ˜¯æ€ä¹ˆè§£å†³çš„**

**ä¸€ä¸ªå…ƒç´ åœ¨ç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ä½ç½®å‘ç”Ÿå˜åŒ–ï¼Œæˆ‘ä»¬è¿˜æƒ³å®šä½å®ƒ**ï¼Œè¿™æ ·çš„åœºæ™¯æˆ‘ä»¬åœ¨ â€œæœ€å°ç´¢å¼•å †â€ ä¸­æ›¾ç»å­¦ä¹ è¿‡ï¼Œä»ä¸­å¾—åˆ°å¯å‘ï¼Œä¸å¦¨ä¹Ÿè®¾ç½®ä¸€ä¸ª â€œç´¢å¼•æ•°ç»„â€ å§ã€‚ä½¿ç”¨ â€œç´¢å¼•æ•°ç»„â€ çš„å…³é”®åœ¨äºï¼š

> **â€œåŸå§‹æ•°ç»„â€ ä¸å˜ï¼Œç”¨äºæ¯”è¾ƒä¸¤ä¸ªå…ƒç´ çš„å¤§å°ï¼ŒçœŸæ­£ä½ç½®å˜æ¢çš„æ˜¯ â€œç´¢å¼•æ•°ç»„â€**ã€‚

ä¸‹é¢æˆ‘å°è¯•è§£é‡Šä¸€ä¸‹ â€œç´¢å¼•æ•°ç»„â€ çš„ä½¿ç”¨æ–¹æ³•ï¼š



![315-2.png](https://pic.leetcode-cn.com/84953655bc88f3c6342d71a79895270675e9034593a713f833fd3edf1c39d231-315-2.png)

**315-2.png**



ä¸ºäº†å®Œæˆ â€œç´¢å¼•æ•°ç»„â€ çš„å½’å¹¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ª â€œç´¢å¼•æ•°ç»„â€ é•¿åº¦çš„ä¸´æ—¶æ•°ç»„ï¼ŒæŠŠç´¢å¼•æ•°ç»„çš„å€¼å¤åˆ¶è¿‡å»ï¼Œæ¯”è¾ƒå®Œæˆä»¥åï¼Œå†èµ‹å€¼å› â€œç´¢å¼•æ•°ç»„â€ã€‚å…·ä½“è¯·çœ‹ä¸‹é¢çš„ä»£ç ã€‚

**æ€»ç»“ï¼š**

> 1ã€æˆ‘ä»¬å€ŸåŠ©è®¡ç®— â€œé€†åºæ•°â€ çš„æ€è·¯å®Œæˆæœ¬é¢˜ï¼Œå…³é”®åœ¨äºè¿™é‡Œæˆ‘ä»¬åªèƒ½åœ¨ â€œå‰æœ‰åºæ•°ç»„â€ å‡ºåˆ—çš„æ—¶å€™è®¡ç®—é€†åºæ•°ï¼›
> å¦‚æœé¢˜ç›®è®©æˆ‘ä»¬è®¡ç®— â€œ`nums[i]` å·¦ä¾§å°äº `nums[i]` çš„å…ƒç´ çš„æ•°é‡â€ å¯ä»¥åœ¨ â€œåæœ‰åºæ•°ç»„â€ å‡ºåˆ—çš„æ—¶å€™è®¡ç®—é€†åºæ•°ï¼›
>
> 2ã€ä½“ä¼š â€œç´¢å¼•æ•°ç»„â€ è¿™ä¸ªä½¿ç”¨æŠ€å·§ã€‚

**ç¼–ç æ³¨æ„äº‹é¡¹**

ä¸€ã€å¯ä»¥å¤ä¹ ä¸€ä¸‹ â€œå½’å¹¶æ’åºâ€ çš„ç»†èŠ‚ã€‚

1ã€å¦‚æœ â€œå‰æœ‰åºæ•°ç»„â€ å’Œ â€œåæœ‰åºæ•°ç»„â€ ç›´æ¥åˆå¹¶çš„æ—¶å€™ï¼Œå°±æœ‰åºï¼Œå°±ä¸å¿…å½’å¹¶ï¼›

2ã€åœ¨ â€œå½’å¹¶â€ çš„æ—¶å€™ï¼Œå…¨å±€ä½¿ç”¨ä¸€ä¸ªä¸´æ—¶å­˜å‚¨æ•°ç»„ï¼Œè€Œä¸å¿…æ¯ä¸€ä¸ªå½’å¹¶éƒ½æ–°å»ºä¸´æ—¶çš„å­˜å‚¨ç©ºé—´ã€‚

äºŒã€å‡ºåˆ—ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œé©¬ä¸Šå¾—åˆ°å³è¾¹æ¯”è‡ªå·±å°çš„å…ƒç´ çš„ä¸ªæ•°ï¼Œæ˜¯é€šè¿‡ä¸åŒçš„æŒ‡é’ˆä¹‹é—´çš„è·ç¦»å¾—åˆ°çš„ã€‚

**åœ¨ç¼–ç çš„æ—¶å€™ï¼Œå»ºè®®åœ¨è‰ç¨¿çº¸ä¸Šå†™å†™ç”»ç”»ï¼Œç”¨å…·ä½“çš„æ•°å€¼å¸¦è¿›å»ï¼Œæ‰èƒ½ç¡®ä¿ä½ è®¡ç®—çš„æŒ‡é’ˆä¹‹é—´çš„è·ç¦»æ­£ç¡®**ã€‚ä¾‹å¦‚æˆ‘å†™çš„ Python ä»£ç  `res[indexes[i]] += (right - mid)` å’Œ `res[indexes[i]] += (r - mid - 1)` è¿™ä¸¤å¥ä»£ç çš„è®¡ç®—ï¼Œæˆ‘å°±æ˜¯åœ¨è‰ç¨¿çº¸ä¸Šç”»å‡ºæ¥çš„ã€‚

ä¸‰ã€å¦‚æœä½ å†™è¿‡ â€œé€†åºæ•°â€ çš„è®¡ç®—çš„ä»£ç ï¼Œä½ å°±ä¼šå‘ç°ï¼Œâ€œé€†åºæ•°â€ çš„è®¡ç®—å¯ä»¥åœ¨ â€œå‰æœ‰åºæ•°ç»„â€ å…ƒç´ å‡ºåˆ—çš„æ—¶å€™è®¡ç®—é€†åºæ•°ï¼Œä¹Ÿå¯ä»¥åœ¨ â€œåæœ‰åºæ•°ç»„â€ å…ƒç´ å‡ºåˆ—çš„æ—¶å€™è®¡ç®—é€†åºæ•°ï¼Œä½ å¯ä»¥æ¯”è¾ƒä¸€ä¸‹å®ƒä»¬åœ¨ç¼–ç æ—¶å€™çš„ä¸åŒä¹‹å¤„ã€‚



![inverse-pairs-1.png](https://pic.leetcode-cn.com/dab4062c5b86895c7ce2fa4ae4902443692bd33f8648d4420609d00d0171c0ff-inverse-pairs-1.png)

**inverse-pairs-1.png**





![inverse-pairs-2.png](https://pic.leetcode-cn.com/0d5881f4ed023caafc73baf6bd7ce0bca265bea5c1d00215d506de8be2fafb18-inverse-pairs-2.png)

**inverse-pairs-2.png**



**å‚è€ƒä»£ç **ï¼š

Python ä»£ç ï¼š

Python

```Python
class Solution:
    def countSmaller(self, nums):
        size = len(nums)
        if size == 0:
            return []
        if size == 1:
            return [0]

        temp = [None for _ in range(size)]
        indexes = [i for i in range(size)]
        res = [0 for _ in range(size)]

        self.__helper(nums, 0, size - 1, temp, indexes, res)
        return res

    def __helper(self, nums, left, right, temp, indexes, res):
        if left == right:
            return
        mid = left + (right - left) // 2

        # è®¡ç®—ä¸€ä¸‹å·¦è¾¹
        self.__helper(nums, left, mid, temp, indexes, res)
        # è®¡ç®—ä¸€ä¸‹å³è¾¹
        self.__helper(nums, mid + 1, right, temp, indexes, res)

        if nums[indexes[mid]] <= nums[indexes[mid + 1]]:
            return
        self.__sort_and_count_smaller(nums, left, mid, right, temp, indexes, res)

    def __sort_and_count_smaller(self, nums, left, mid, right, temp, indexes, res):
        # [left,mid] å‰æœ‰åºæ•°ç»„
        # [mid+1,right] åæœ‰åºæ•°ç»„

        # å…ˆæ‹·è´ï¼Œå†åˆå¹¶

        for i in range(left, right + 1):
            temp[i] = indexes[i]

        l = left
        r = mid + 1
        for i in range(left, right + 1):
            if l > mid:
                # l ç”¨å®Œï¼Œå°±æ‹¼å‘½ä½¿ç”¨ r
                # [1,2,3,4] [5,6,7,8]
                indexes[i] = temp[r]
                r += 1
            elif r > right:
                # r ç”¨å®Œï¼Œå°±æ‹¼å‘½ä½¿ç”¨ l
                # [6,7,8,9] [1,2,3,4]
                indexes[i] = temp[l]
                l += 1
                # æ³¨æ„ï¼šæ­¤æ—¶å‰é¢å‰©ä¸‹çš„æ•°ï¼Œæ¯”åé¢æ‰€æœ‰çš„æ•°éƒ½å¤§
                res[indexes[i]] += (right - mid)
            elif nums[temp[l]] <= nums[temp[r]]:
                # [3,5,7,9] [4,6,8,10]
                indexes[i] = temp[l]
                l += 1
                # æ³¨æ„ï¼š
                res[indexes[i]] += (r - mid - 1)
            else:
                assert nums[temp[l]] > nums[temp[r]]
                # ä¸Šé¢ä¸¤ç§æƒ…å†µåªåœ¨å…¶ä¸­ä¸€ç§ç»Ÿè®¡å°±å¯ä»¥äº†
                # [3,5,7,9] [4,6,8,10]
                indexes[i] = temp[r]
                r += 1
```

Java ä»£ç ï¼š

Java

```Java
import java.util.ArrayList;
import java.util.List;

public class Solution {

    private int[] temp;
    private int[] counter;
    private int[] indexes;

    public List countSmaller(int[] nums) {
        List res = new ArrayList<>();
        int len = nums.length;
        if (len == 0) {
            return res;
        }
        temp = new int[len];
        counter = new int[len];
        indexes = new int[len];
        for (int i = 0; i < len; i++) {
            indexes[i] = i;
        }
        mergeAndCountSmaller(nums, 0, len - 1);
        for (int i = 0; i < len; i++) {
            res.add(counter[i]);
        }
        return res;
    }

    /**
     * é’ˆå¯¹æ•°ç»„ nums æŒ‡å®šçš„åŒºé—´ [l, r] è¿›è¡Œå½’å¹¶æ’åºï¼Œåœ¨æ’åºçš„è¿‡ç¨‹ä¸­å®Œæˆç»Ÿè®¡ä»»åŠ¡
     *
     * @param nums
     * @param l
     * @param r
     */
    private void mergeAndCountSmaller(int[] nums, int l, int r) {
        if (l == r) {
            // æ•°ç»„åªæœ‰ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œæ²¡æœ‰æ¯”è¾ƒï¼Œä¸ç»Ÿè®¡
            return;
        }
        int mid = l + (r - l) / 2;
        mergeAndCountSmaller(nums, l, mid);
        mergeAndCountSmaller(nums, mid + 1, r);
        // å½’å¹¶æ’åºçš„ä¼˜åŒ–ï¼ŒåŒæ ·é€‚ç”¨äºè¯¥é—®é¢˜
        // å¦‚æœç´¢å¼•æ•°ç»„æœ‰åºï¼Œå°±æ²¡æœ‰å¿…è¦å†ç»§ç»­è®¡ç®—äº†
        if (nums[indexes[mid]] > nums[indexes[mid + 1]]) {
            mergeOfTwoSortedArrAndCountSmaller(nums, l, mid, r);
        }
    }

    /**
     * [l, mid] æ˜¯æ’å¥½åºçš„
     * [mid + 1, r] æ˜¯æ’å¥½åºçš„
     *
     * @param nums
     * @param l
     * @param mid
     * @param r
     */
    private void mergeOfTwoSortedArrAndCountSmaller(int[] nums, int l, int mid, int r) {
        // 3,4  1,2
        for (int i = l; i <= r; i++) {
            temp[i] = indexes[i];
        }
        int i = l;
        int j = mid + 1;
        // å·¦è¾¹å‡ºåˆ—çš„æ—¶å€™ï¼Œè®¡æ•°
        for (int k = l; k <= r; k++) {
            if (i > mid) {
                indexes[k] = temp[j];
                j++;
            } else if (j > r) {
                indexes[k] = temp[i];
                i++;
                // æ­¤æ—¶ j ç”¨å®Œäº†ï¼Œ[7,8,9 | 1,2,3]
                // ä¹‹å‰çš„æ•°å°±å’Œåé¢çš„åŒºé—´é•¿åº¦æ„æˆé€†åº
                counter[indexes[k]] += (r - mid);
            } else if (nums[temp[i]] <= nums[temp[j]]) {
                indexes[k] = temp[i];
                i++;
                // æ­¤æ—¶ [4,5, 6   | 1,2,3 10 12 13]
                //           mid          j
                counter[indexes[k]] += (j - mid - 1);
            } else {
                // nums[indexes[i]] > nums[indexes[j]] æ„æˆé€†åº
                indexes[k] = temp[j];
                j++;
            }
        }
    }

    public static void main(String[] args) {
        int[] nums = new int[]{5, 2, 6, 1};
        Solution solution = new Solution();
        List countSmaller = solution.countSmaller(nums);
        System.out.println(countSmaller);
    }
}
```

**å¤æ‚åº¦åˆ†æï¼š**

- æ—¶é—´å¤æ‚åº¦ï¼šğ‘‚(ğ‘logğ‘)O(Nlogâ¡N)ï¼Œæ•°ç»„çš„å…ƒç´ ä¸ªæ•°æ˜¯ ğ‘Nï¼Œé€’å½’æ‰§è¡Œåˆ†æ²»æ³•ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯å¯¹æ•°çº§åˆ«çš„ï¼Œå› æ­¤æ—¶é—´å¤æ‚åº¦æ˜¯ ğ‘‚(ğ‘logğ‘)O(Nlogâ¡N)ã€‚
- ç©ºé—´å¤æ‚åº¦ï¼šğ‘‚(ğ‘)O(N)ï¼Œéœ€è¦ 33 ä¸ªæ•°ç»„ï¼Œä¸€ä¸ªç´¢å¼•æ•°ç»„ï¼Œä¸€ä¸ªä¸´æ—¶æ•°ç»„ç”¨äºç´¢å¼•æ•°ç»„çš„å½’å¹¶ï¼Œè¿˜æœ‰ä¸€ä¸ªç»“æœæ•°ç»„ï¼Œå®ƒä»¬çš„é•¿åº¦éƒ½æ˜¯ ğ‘Nï¼Œæ•…ç©ºé—´å¤æ‚åº¦æ˜¯ ğ‘‚(ğ‘)O(N)ã€‚

è¿™é“é¢˜è¿˜å¯ä»¥ä½¿ç”¨æ ‘çŠ¶æ•°ç»„æ±‚è§£ï¼Œè¿™ä¸€ç‚¹æˆ‘ä»¬ä»¥åå†ä»‹ç»ã€‚