## ã€ŒåŠ›æ‰£ã€ç¬¬ 152 é¢˜ï¼šä¹˜ç§¯æœ€å¤§å­åºåˆ—ï¼ˆä¸­ç­‰ï¼‰

- [é“¾æ¥](https://leetcode-cn.com/problems/maximum-product-subarray/)
- [é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/maximum-product-subarray/solution/er-wei-dong-tai-gui-hua-by-liweiwei1419/)

> ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œæ‰¾å‡ºä¸€ä¸ªåºåˆ—ä¸­ä¹˜ç§¯æœ€å¤§çš„è¿ç»­å­åºåˆ—ï¼ˆè¯¥åºåˆ—è‡³å°‘åŒ…å«ä¸€ä¸ªæ•°ï¼‰ã€‚
>
> ç¤ºä¾‹ 1ï¼š
>
> ```
> è¾“å…¥: [2, 3, -2, 4]
> è¾“å‡º: 6
> è§£é‡Š: å­æ•°ç»„ [2,3] æœ‰æœ€å¤§ä¹˜ç§¯ 6ã€‚
> ```
>
> ç¤ºä¾‹ 2ï¼š
>
> ```
> è¾“å…¥: [-2, 0, -1]
> è¾“å‡º: 0
> è§£é‡Š: ç»“æœä¸èƒ½ä¸º 2, å› ä¸º [-2,-1] ä¸æ˜¯å­æ•°ç»„ã€‚
> ```

### æ–¹æ³•ï¼šåŠ¨æ€è§„åˆ’

**æ€è·¯åˆ†æ**ï¼š

è¿™é“é¢˜æ€è€ƒâ€œçŠ¶æ€â€ä»¥åŠâ€œçŠ¶æ€è½¬ç§»æ–¹ç¨‹â€çš„æ¨å¯¼æ€è·¯ç±»ä¼¼ [ã€ŒåŠ›æ‰£ã€ç¬¬ 53 é¢˜ï¼šâ€œæœ€å¤§å­åºå’Œâ€](https://leetcode-cn.com/problems/maximum-subarray/) ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å…ˆåšä¸€ä¸‹ã€‚æˆ‘æ„Ÿè§‰è¿™ä¸ªé—®é¢˜è¿˜æ˜¯æœ‰ç‚¹éš¾çš„ï¼Œä¸è¿‡åªè¦æŠŠä¸€äº›ç‰¹æ®Šçš„æƒ…å†µè€ƒè™‘æ¸…æ¥šï¼ŒçŠ¶æ€è½¬ç§»æ–¹ç¨‹å°±ä¸æ˜¯é‚£ä¹ˆéš¾å†™äº†ã€‚

æ•°ç»„çš„åŠ¨æ€è§„åˆ’é—®é¢˜ã€å­åºåˆ—ã€è¿ç»­å­åºåˆ—çš„ä¸€ä¸ªé€šç”¨çš„çŠ¶æ€è®¾ç½®æ˜¯ï¼š

> ä»¥ç´¢å¼• `i` ç»“å°¾çš„è¿ç»­å­åºåˆ—çš„ä¹˜ç§¯çš„æœ€å¤§å€¼ã€‚

æœ€åæŠŠæ•´ä¸ª `dp` æ•°ç»„çœ‹ä¸€éæ±‚æœ€å¤§å€¼å³å¯ã€‚å› æ­¤çŠ¶æ€è½¬ç§»æ–¹ç¨‹å¯èƒ½æ˜¯ï¼š

```
dp[i] = max(dp[i - 1] * nums[i], nums[i])
```

è¯´æ˜ï¼šç‰¢è®°çŠ¶æ€çš„è®¾ç½®ï¼Œä¸€å®šä»¥ç´¢å¼• `i` ç»“å°¾ï¼Œå³ä¹˜ç§¯æ•°ç»„ä¸­ `nums[i]` å¿…é¡»è¢«é€‰å–ã€‚

- å¦‚æœ `dp[i - 1]` æ˜¯è´Ÿæ•°ï¼Œä¹˜ä¸Š `nums[i]` è¿˜æ˜¯è´Ÿæ•°ï¼Œå€’ä¸å¦‚å¦èµ·ç‚‰ç¶ã€‚
- å¦‚æœ `nums[i]` æ˜¯è´Ÿæ•°è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ`dp[i - 1]` æ˜¯æ­£æ•°çš„æ—¶å€™ï¼Œè¶Šä¹˜è¶Šå°ï¼Œ`dp[i - 1]` æ˜¯è´Ÿæ•°çš„æ—¶å€™ï¼Œè¶Šä¹˜è¶Šå¤§ï¼Œäºæ˜¯æˆ‘ä»¬å¯èƒ½å°±éœ€è¦è®°å½•ä¸€ä¸‹è´Ÿæ•°çš„é‚£ä¸ªæœ€å°æ•°ã€‚

é‡åˆ°è¿™æ ·çš„é—®é¢˜ï¼Œå…¶å®å°±åœ¨æç¤ºæˆ‘ä»¬çŠ¶æ€ä¸å¤Ÿç”¨äº†ã€‚å› æ­¤ï¼Œéœ€è¦åœ¨åŸæ¥çš„ä¸€ç»´ `dp` åé¢æ–°å¢ä¸€ä¸ªçŠ¶æ€ã€‚

é’ˆå¯¹è¿™é“é¢˜ï¼Œç¬¬ 2 ç»´çŠ¶æ€åªéœ€è¦ä¸¤ä¸ªï¼š

- ç”¨ `0` è¡¨ç¤ºéå†çš„è¿‡ç¨‹ä¸­å¾—åˆ°çš„ä»¥ `nums[i]` ç»“å°¾çš„è¿ç»­å­åºåˆ—çš„ä¹˜ç§¯çš„æœ€å°å€¼ï¼›
- ç”¨ `1` è¡¨ç¤ºéå†çš„è¿‡ç¨‹ä¸­å¾—åˆ°çš„ä»¥ `nums[i]` ç»“å°¾çš„è¿ç»­å­åºåˆ—çš„ä¹˜ç§¯çš„æœ€å¤§å€¼ã€‚

å½“ `nums[i] = 0` çš„æ—¶å€™åŒ…å«åœ¨ä¸Šé¢äºŒè€…ä¹‹ä¸­ï¼Œæ— éœ€å•ç‹¬è®¨è®ºã€‚

çŠ¶æ€è½¬ç§»æ–¹ç¨‹å†™åœ¨äº†å‚è€ƒä»£ç  1 ä¸­ã€‚å³ä½¿ç”¨äºŒç»´çŠ¶æ€æ•°ç»„åŒæ—¶è®°å½•ä¹˜ç§¯çš„æœ€å¤§å€¼å’Œæœ€å°å€¼ï¼Œæœ¬æ¥å†™äº†ä¸€å †æ–‡å­—çš„ï¼Œåæ¥çœ‹å¤ªé•¿äº†ï¼Œå¥½å¤šåºŸè¯ï¼Œç›´æ¥çœ‹ä»£ç æ¯”è¾ƒæ¸…æ¥šä¸€äº›ã€‚

è¿™é‡Œå°±å£°æ˜ä¸€ä¸‹çŠ¶æ€ï¼š

- `dp[i][1]` è¡¨ç¤ºï¼šä»¥ `nums[i]` ç»“å°¾çš„è¿ç»­å­åºåˆ—çš„ä¹˜ç§¯çš„æœ€å¤§å€¼ï¼›
- `dp[i][0]` è¡¨ç¤ºï¼šä»¥ `nums[i]` ç»“å°¾çš„è¿ç»­å­åºåˆ—çš„ä¹˜ç§¯çš„æœ€å°å€¼ã€‚

**å‚è€ƒä»£ç  1**ï¼š

Java

```Java
public class Solution {


    public int maxProduct(int[] nums) {
        int len = nums.length;
        if (len == 0) {
            return 0;
        }

        // çŠ¶æ€å®šä¹‰ï¼šä»¥ç´¢å¼• i ç»“å°¾
        int[][] dp = new int[len][2];

        dp[0][0] = nums[0];
        dp[0][1] = nums[0];

        for (int i = 1; i < len; i++) {
            if (nums[i] >= 0) {
                dp[i][1] = Math.max(nums[i], dp[i - 1][1] * nums[i]);
                dp[i][0] = Math.min(nums[i], dp[i - 1][0] * nums[i]);
            } else {
                dp[i][1] = Math.max(nums[i], dp[i - 1][0] * nums[i]);
                dp[i][0] = Math.min(nums[i], dp[i - 1][1] * nums[i]);
            }
        }

        int res = dp[0][1];
        for (int i = 1; i < len; i++) {
            res = Math.max(res, dp[i][1]);
        }
        return res;
    }

}
```

**å¤æ‚åº¦åˆ†æ**ï¼š

- æ—¶é—´å¤æ‚åº¦ï¼šğ‘‚(ğ‘)O(N)ï¼Œè¿™é‡Œ ğ‘N è¡¨ç¤ºæ•°ç»„çš„é•¿åº¦ã€‚
- ç©ºé—´å¤æ‚åº¦ï¼šğ‘‚(ğ‘)O(N)ï¼Œä½¿ç”¨äº†ä¸¤ä¸ªçŠ¶æ€æ•°ç»„ï¼Œæ¯ä¸€ä¸ªæ•°ç»„çš„è§„æ¨¡æ˜¯ ğ‘Nã€‚

æˆ–è€…è®¾ç½®ä¸¤ä¸ªçŠ¶æ€æ•°ç»„ï¼Œè¿™æ ·è¯­ä¹‰ä¼šæ›´æ¸…æ™°ä¸€äº›ï¼š

**å‚è€ƒä»£ç  2**ï¼š

Java

```Java
public class Solution {

    // å‚è€ƒï¼šåŠ›æ‰£ç¬¬53 é¢˜æ€è·¯

    public int maxProduct(int[] nums) {
        int len = nums.length;
        if (len == 0) {
            return 0;
        }

        // çŠ¶æ€å®šä¹‰ï¼šä»¥ç´¢å¼• i ç»“å°¾
        // æ€è€ƒæ¸…æ¥šä¸€ç§ç‰¹ä¾‹ï¼š [2, -1 ,3]ï¼Œå‰é¢ä¹˜èµ·æ¥æ˜¯è´Ÿæ•°çš„è¯ï¼Œå€’ä¸å¦‚å¦èµ·ç‚‰ç¶
        int[] maxDp = new int[len];
        int[] minDp = new int[len];

        maxDp[0] = nums[0];
        minDp[0] = nums[0];

        for (int i = 1; i < len; i++) {
            if (nums[i] >= 0) {
                maxDp[i] = Math.max(nums[i], maxDp[i - 1] * nums[i]);
                minDp[i] = Math.min(nums[i], minDp[i - 1] * nums[i]);
            } else {
                maxDp[i] = Math.max(nums[i], minDp[i - 1] * nums[i]);
                minDp[i] = Math.min(nums[i], maxDp[i - 1] * nums[i]);
            }
        }

        int res = maxDp[0];
        for (int i = 1; i < len; i++) {
            res = Math.max(res, maxDp[i]);
        }
        return res;
    }
}
```

**å¤æ‚åº¦åˆ†æ**ï¼šï¼ˆåŒä¸Šï¼‰ã€‚

å› ä¸ºæ¯ä¸€ä¸ªçŠ¶æ€åªä¸å‰ä¸€ä¸ªçŠ¶æ€æœ‰å…³ï¼Œå¯ä»¥ä½¿ç”¨ã€Œæ»šåŠ¨å˜é‡ã€æŠ€å·§ï¼ŒæŠŠçŠ¶æ€æ•°ç»„å‹ç¼©åˆ°å¸¸æ•°ã€‚

**å‚è€ƒä»£ç  3**ï¼š

Java

```Java
public class Solution {

    public int maxProduct(int[] nums) {
        int len = nums.length;
        if (len == 0) {
            return 0;
        }

        int preMax = nums[0];
        int preMin = nums[0];
        int curMax;
        int curMin;

        int res = nums[0];
        for (int i = 1; i < len; i++) {
            if (nums[i] >= 0) {
                curMax = Math.max(preMax * nums[i], nums[i]);
                curMin = Math.min(preMin * nums[i], nums[i]);
            } else {
                curMax = Math.max(preMin * nums[i], nums[i]);
                curMin = Math.min(preMax * nums[i], nums[i]);
            }
            res = Math.max(res, curMax);

            // æ»šåŠ¨å˜é‡
            preMax = curMax;
            preMin = curMin;
        }
        return res;
    }
}
```

**å¤æ‚åº¦åˆ†æ**ï¼š

- æ—¶é—´å¤æ‚åº¦ï¼šğ‘‚(ğ‘)O(N)ï¼Œè¿™é‡Œ ğ‘N è¡¨ç¤ºæ•°ç»„çš„é•¿åº¦ã€‚
- ç©ºé—´å¤æ‚åº¦ï¼šğ‘‚(1)O(1)ï¼Œä½¿ç”¨äº†å¸¸æ•°ä¸ªå˜é‡ã€‚