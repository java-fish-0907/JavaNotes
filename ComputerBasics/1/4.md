## ã€Œæ’åºç®—æ³•ã€ä¸“é¢˜ 4ï¼šå½’å¹¶æ’åºçš„ä¼˜åŒ–

æ ¹æ®ä¸Šä¸€èŠ‚çš„ã€Œå½’å¹¶æ’åºã€çš„ 3 ä¸ªä¼˜åŒ–ï¼Œå†™å‡ºçš„ä»£ç ã€‚

Java ä»£ç ï¼š

java

```java
public class Solution {

    /**
     * åˆ—è¡¨å¤§å°ç­‰äºæˆ–å°äºè¯¥å¤§å°ï¼Œå°†ä¼˜å…ˆäº mergeSort ä½¿ç”¨æ’å…¥æ’åº
     */
    private static final int INSERTION_SORT_THRESHOLD = 7;

    public int[] sortArray(int[] nums) {
        int len = nums.length;
        int[] temp = new int[len];
        mergeSort(nums, 0, len - 1, temp);
        return nums;
    }

    /**
     * å¯¹æ•°ç»„ nums çš„å­åŒºé—´ [left, right] è¿›è¡Œå½’å¹¶æ’åº
     *
     * @param nums
     * @param left
     * @param right
     * @param temp  ç”¨äºåˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„çš„è¾…åŠ©æ•°ç»„ï¼Œå…¨å±€ä½¿ç”¨ä¸€ä»½ï¼Œé¿å…å¤šæ¬¡åˆ›å»ºå’Œé”€æ¯
     */
    private void mergeSort(int[] nums, int left, int right, int[] temp) {
        // å°åŒºé—´ä½¿ç”¨æ’å…¥æ’åº
        if (right - left <= INSERTION_SORT_THRESHOLD) {
            insertionSort(nums, left, right);
            return;
        }

        int mid = left + (right - left) / 2;
        // Java é‡Œæœ‰æ›´ä¼˜çš„å†™æ³•ï¼Œåœ¨ left å’Œ right éƒ½æ˜¯å¤§æ•´æ•°æ—¶ï¼Œå³ä½¿æº¢å‡ºï¼Œç»“è®ºä¾ç„¶æ­£ç¡®
        // int mid = (left + right) >>> 1;

        mergeSort(nums, left, mid, temp);
        mergeSort(nums, mid + 1, right, temp);
        // å¦‚æœæ•°ç»„çš„è¿™ä¸ªå­åŒºé—´æœ¬èº«æœ‰åºï¼Œæ— éœ€åˆå¹¶
        if (nums[mid] <= nums[mid + 1]) {
            return;
        }
        mergeOfTwoSortedArray(nums, left, mid, right, temp);
    }

    /**
     * å¯¹æ•°ç»„ arr çš„å­åŒºé—´ [left, right] ä½¿ç”¨æ’å…¥æ’åº
     *
     * @param arr   ç»™å®šæ•°ç»„
     * @param left  å·¦è¾¹ç•Œï¼Œèƒ½å–åˆ°
     * @param right å³è¾¹ç•Œï¼Œèƒ½å–åˆ°
     */
    private void insertionSort(int[] arr, int left, int right) {
        for (int i = left + 1; i <= right; i++) {
            int temp = arr[i];
            int j = i;
            while (j > left && arr[j - 1] > temp) {
                arr[j] = arr[j - 1];
                j--;
            }
            arr[j] = temp;
        }
    }

    /**
     * åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„ï¼šå…ˆæŠŠå€¼å¤åˆ¶åˆ°ä¸´æ—¶æ•°ç»„ï¼Œå†åˆå¹¶å›å»
     *
     * @param nums
     * @param left
     * @param mid   [left, mid] æœ‰åºï¼Œ[mid + 1, right] æœ‰åº
     * @param right
     * @param temp  å…¨å±€ä½¿ç”¨çš„ä¸´æ—¶æ•°ç»„
     */
    private void mergeOfTwoSortedArray(int[] nums, int left, int mid, int right, int[] temp) {
        System.arraycopy(nums, left, temp, left, right + 1 - left);

        int i = left;
        int j = mid + 1;

        for (int k = left; k <= right; k++) {
            if (i == mid + 1) {
                nums[k] = temp[j];
                j++;
            } else if (j == right + 1) {
                nums[k] = temp[i];
                i++;
            } else if (temp[i] <= temp[j]) {
                // æ³¨æ„å†™æˆ < å°±ä¸¢å¤±äº†ç¨³å®šæ€§ï¼ˆç›¸åŒå…ƒç´ åŸæ¥é å‰çš„æ’åºä»¥åä¾ç„¶é å‰ï¼‰
                nums[k] = temp[i];
                i++;
            } else {
                // temp[i] > temp[j]
                nums[k] = temp[j];
                j++;
            }
        }
    }
}
```

Python ä»£ç ï¼š

python

```python
class MergeSortOptimizer:

    def __str__(self):
        return "å½’å¹¶æ’åºçš„ä¼˜åŒ–"

    def __merge_of_two_sorted_array(self, arr, left, mid, right):
        # å°†åŸæ•°ç»„ [left, right] åŒºé—´å†…çš„å…ƒç´ å¤åˆ¶åˆ°è¾…åŠ©æ•°ç»„
        for index in range(left, right + 1):
            nums_for_compare[index] = arr[index]

        i = left
        j = mid + 1
        for k in range(left, right + 1):
            if i == mid + 1:
                # i ç”¨å®Œäº†ï¼Œå°±æ‹¼å‘½ç”¨ j
                arr[k] = nums_for_compare[j]
                j += 1
            elif j > right:
                # j ç”¨å®Œäº†ï¼Œå°±æ‹¼å‘½ç”¨ i
                arr[k] = nums_for_compare[i]
                i += 1
            elif nums_for_compare[i] <= nums_for_compare[j]:
                arr[k] = nums_for_compare[i]
                i += 1
            else:
                assert nums_for_compare[i] > nums_for_compare[j]
                arr[k] = nums_for_compare[j]
                j += 1

    def insert_sort_for_sub_interval(self, arr, left, right):
        """å¤šæ¬¡èµ‹å€¼çš„æ’å…¥æ’åº"""
        for i in range(left + 1, right + 1):
            temp = arr[i]
            j = i
            # æ³¨æ„ï¼šè¿™é‡Œ j æœ€å¤šåˆ° left
            while j > left and arr[j - 1] > temp:
                arr[j] = arr[j - 1]
                j -= 1
            arr[j] = temp

    def __merge_sort(self, arr, left, right):
        if right - left <= 15:
            self.insert_sort_for_sub_interval(arr, left, right)
            return
        mid = left + (right - left) // 2
        self.__merge_sort(arr, left, mid)
        self.__merge_sort(arr, mid + 1, right)
        if arr[mid] <= arr[mid + 1]:
            return
        self.__merge_of_two_sorted_array(arr, left, mid, right)

    @SortingUtil.cal_time
    def sort(self, arr):
        global nums_for_compare
        size = len(arr)
        nums_for_compare = list(range(size))
        self.__merge_sort(arr, 0, size - 1)
```

**å¤æ‚åº¦åˆ†æ**ï¼š

- æ—¶é—´å¤æ‚åº¦ï¼šğ‘‚(ğ‘logğ‘)O(Nlogâ¡N)ï¼Œè¿™é‡Œ ğ‘N æ˜¯æ•°ç»„çš„é•¿åº¦ï¼›
- ç©ºé—´å¤æ‚åº¦ï¼šğ‘‚(ğ‘)O(N)ï¼Œè¾…åŠ©æ•°ç»„ä¸è¾“å…¥æ•°ç»„è§„æ¨¡ç›¸å½“ã€‚

ï¼ˆæœ¬èŠ‚å®Œï¼‰