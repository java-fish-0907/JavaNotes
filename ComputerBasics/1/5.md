## ã€Œæ’åºç®—æ³•ã€ä¸“é¢˜ 5ï¼šã€Œåˆ†æ²»æ€æƒ³ã€ç»å…¸ä¾‹å­

è¿™é‡Œç»™å‡ºçš„ä¾‹é¢˜çš„è§£é¢˜æ€è·¯å¦‚æœå¯¹äºåˆå­¦è€…æ¥è¯´å¯èƒ½ä¸æ˜¯å¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œä¸è¿‡å…¶å®ä½ åªè¦ç†Ÿæ‚‰å½’å¹¶æ’åºï¼ŒæŒ‰ç…§å½’å¹¶æ’åºçš„å¥—è·¯ï¼Œæ˜¯ä¸éš¾å†™å‡ºä¸‹é¢çš„ä»£ç ã€‚åæ­£ä¸è¿‡æˆ‘æ˜¯å†™ä¸å‡ºçš„ï¼Œä¸è¿‡æˆ‘ä¼šçœ‹åˆ«äººå†™çš„ä»£ç ï¼Œç†è§£ä¹‹åï¼Œè‡ªå·±å†™å‡ºæ¥ã€‚å¦‚æœè§‰å¾—ç†è§£è¿™äº›ä»£ç æ¯”è¾ƒåƒåŠ›çš„è¯ï¼Œå¯ä»¥æš‚æ—¶è·³è¿‡ï¼Œæˆ‘å†™å‡ºæ¥è¿˜æ˜¯è´¹äº†å¾ˆå¤§åŠ›æ°”ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯è°ƒè¯•å’Œä¸€æ®µæ—¶é—´æ‰æŠŠä»£ç å†™æ­£ç¡®çš„ã€‚

æœ¬èŠ‚ä»‹ç»äº† 3 é“ä¾‹é¢˜ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼šè®¡ç®—æ•°ç»„çš„é€†åºå¯¹ã€è®¡ç®—å³ä¾§å°äºå½“å‰å…ƒç´ çš„ä¸ªæ•°ã€æœ€å¤§å­åºå’Œã€‚

### ä¾‹1ï¼šã€Šå‰‘æŒ‡ Offerã€‹ï¼ˆç¬¬ 2 ç‰ˆï¼‰ç¬¬ 51 é¢˜ï¼šè®¡ç®—æ•°ç»„çš„é€†åºå¯¹

- é“¾æ¥ï¼š[ã€Šå‰‘æŒ‡ Offerã€‹ï¼ˆç¬¬ 2 ç‰ˆï¼‰ç¬¬ 51 é¢˜ï¼šè®¡ç®—æ•°ç»„çš„é€†åºå¯¹](https://leetcode-cn.com/problems/shu-zu-zhong-de-ni-xu-dui-lcof/)ï¼›
- å®˜æ–¹é¢˜è§£é“¾æ¥ï¼ˆæœ‰è§†é¢‘è®²è§£ï¼‰ï¼š[æ•°ç»„ä¸­çš„é€†åºå¯¹](https://leetcode-cn.com/problems/shu-zu-zhong-de-ni-xu-dui-lcof/solution/shu-zu-zhong-de-ni-xu-dui-by-leetcode-solution/)ï¼›
- é¢˜è§£é“¾æ¥ï¼š[æš´åŠ›è§£æ³•ã€åˆ†æ²»æ€æƒ³ã€æ ‘çŠ¶æ•°ç»„](https://leetcode-cn.com/problems/shu-zu-zhong-de-ni-xu-dui-lcof/solution/bao-li-jie-fa-fen-zhi-si-xiang-shu-zhuang-shu-zu-b/)ã€‚

> åœ¨æ•°ç»„ä¸­çš„ä¸¤ä¸ªæ•°å­—å¦‚æœå‰é¢ä¸€ä¸ªæ•°å­—å¤§äºåé¢çš„æ•°å­—ï¼Œåˆ™è¿™ä¸¤ä¸ªæ•°å­—ç»„æˆä¸€ä¸ªé€†åºå¯¹ã€‚
>
> è¾“å…¥ä¸€ä¸ªæ•°ç»„ï¼Œæ±‚å‡ºè¿™ä¸ªæ•°ç»„ä¸­çš„é€†åºå¯¹çš„æ€»æ•°ã€‚
>
> #### æ ·ä¾‹
>
> ```
> è¾“å…¥ï¼š[1,2,3,4,5,6,0]
> 
> è¾“å‡ºï¼š6
> ```

#### æ–¹æ³•ä¸€ï¼šæ ¹æ®å®šä¹‰

é¦–å…ˆæˆ‘ä»¬åº”è¯¥æƒ³åˆ°ï¼Œä½¿ç”¨å®šä¹‰è®¡ç®—é€†åºæ•°ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ï¼šğ‘‚(ğ‘›2)O(n2)ã€‚

Java ä»£ç ï¼š

java

```java
public class Solution {

    public int reversePairs(int[] nums) {
        int cnt = 0;
        int len = nums.length;
        for (int i = 0; i < len - 1; i++) {
            for (int j = i + 1; j < len; j++) {
                if (nums[i] > nums[j]) {
                    cnt++;
                }
            }
        }
        return cnt;
    }
}
```

Python ä»£ç ï¼š

python

```python
class Solution(object):
    def inversePairs(self, nums):
        l = len(nums)
        if l < 2:
            return 0
        res = 0
        for i in range(0, l - 1):
            for j in range(i + 1, l):
                if nums[i] > nums[j]:
                    res += 1
        return res
```

#### æ–¹æ³•äºŒï¼šåˆ†æ²»ç®—æ³•ï¼ˆå€ŸåŠ©å½’å¹¶æ’åºï¼‰

è¿™ç§æ€è·¯è™½ç„¶å¾ˆç›´æ¥ï¼Œä½†ç¼–å†™å‡ºé”™çš„æ¦‚ç‡å°±å¾ˆä½äº†ï¼Œåœ¨æ²¡æœ‰åœ¨çº¿è¯„æµ‹ç³»ç»Ÿçš„æ—¶å€™ï¼Œå®ƒå¯ä»¥ä½œä¸ºä¸€ä¸ªã€Œæ­£ç¡®çš„ã€å‚è€ƒç­”æ¡ˆï¼Œç”¨ä»¥æ£€éªŒæˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ç®—æ³•æ˜¯å¦æ­£ç¡®ã€‚

æ€è·¯2ï¼šå€ŸåŠ©å½’å¹¶æ’åºçš„åˆ†æ²»æ€æƒ³ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º ğ‘‚(ğ‘›logğ‘›)O(nlogâ¡n)ã€‚

åˆ†æï¼šä¾‹å¦‚ï¼šå‰æœ‰åºæ•°ç»„ï¼š[2,3,5,8][2,3,5,8]ï¼Œåæœ‰åºæ•°ç»„ï¼š[4,6,7,12][4,6,7,12]ã€‚

åšå½’å¹¶çš„æ—¶å€™ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š

ç¬¬ 1 æ­¥ï¼Œ22 å…ˆå‡ºåˆ—ï¼Œ22 æ¯”â€œåæœ‰åºæ•°ç»„â€ä¸­æ‰€æœ‰çš„å…ƒç´ éƒ½å°ï¼Œæ„æˆâ€œé¡ºåºå¯¹â€ï¼›

ç¬¬ 2 æ­¥ï¼Œ33 å‡ºåˆ—ï¼Œ33 æ¯”â€œåæœ‰åºæ•°ç»„â€ä¸­æ‰€æœ‰çš„å…ƒç´ éƒ½å°ï¼Œæ„æˆâ€œé¡ºåºå¯¹â€ï¼›

ç¬¬ 3 æ­¥ï¼Œ44 å‡ºåˆ—ï¼Œå…³é”®çš„åœ°æ–¹åœ¨è¿™é‡Œï¼Œ**â€œå‰æœ‰åºæ•°ç»„â€ä¸­æ‰€æœ‰å‰©ä¸‹çš„å…ƒç´  [5,8][5,8] æ¯” 44 éƒ½å¤§ï¼Œæ„æˆ 22 ä¸ª â€œé€†åºå¯¹â€**ï¼›

ç¬¬ 4 æ­¥ï¼Œ55 å‡ºåˆ—ï¼Œ55 æ¯”â€œåæœ‰åºæ•°ç»„â€ä¸­æ‰€æœ‰å‰©ä¸‹çš„å…ƒç´ éƒ½å°ï¼Œæ„æˆâ€œé¡ºåºå¯¹â€ï¼›

ç¬¬ 5 æ­¥ï¼Œ66 å‡ºåˆ—ï¼Œ**â€œå‰æœ‰åºæ•°ç»„â€ä¸­æ‰€æœ‰å‰©ä¸‹çš„å…ƒç´  [8][8] æ¯” 66 éƒ½å¤§ï¼Œæ„æˆ 11 ä¸ªâ€œé€†åºå¯¹â€**ï¼›

ç¬¬ 6 æ­¥ï¼Œ77 å‡ºåˆ—ï¼Œ**â€œå‰æœ‰åºæ•°ç»„â€ä¸­æ‰€æœ‰å‰©ä¸‹çš„å…ƒç´  [8][8] æ¯” 77 éƒ½å¤§ï¼Œæ„æˆ 11 ä¸ªâ€œé€†åºå¯¹â€**ï¼›

ç¬¬ 7 æ­¥ï¼Œ88 å‡ºåˆ—ï¼Œ88 æ¯”â€œåæœ‰åºæ•°ç»„â€ä¸­æ‰€æœ‰å‰©ä¸‹çš„å…ƒç´  [8][8] éƒ½å°ï¼Œæ„æˆ 11 ä¸ªâ€œé¡ºåºå¯¹â€ï¼›

ç¬¬ 8 æ­¥ï¼Œ1212 å‡ºåˆ—ï¼Œæ­¤æ—¶â€œå‰æœ‰åºæ•°ç»„â€ä¸ºç©ºã€‚

å› æ­¤ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨**â€œå‰æœ‰åºæ•°ç»„â€éç©ºï¼Œä¸”â€œåæœ‰åºæ•°ç»„â€ä¸­æœ‰å…ƒç´ å‡ºåˆ—çš„æ—¶å€™ï¼Œå³ä¸Šé¢çš„ç¬¬ 3ã€5ã€6 æ­¥è®¡ç®—â€œé€†åºå¯¹â€å°±å¯ä»¥äº†**ã€‚

Java ä»£ç ï¼š

java

```java
public class Solution {

    public int reversePairs(int[] nums) {
        int len = nums.length;

        if (len < 2) {
            return 0;
        }

        int[] copy = new int[len];
        for (int i = 0; i < len; i++) {
            copy[i] = nums[i];
        }

        int[] temp = new int[len];
        return reversePairs(copy, 0, len - 1, temp);
    }

    /**
     * nums[left..right] è®¡ç®—é€†åºå¯¹ä¸ªæ•°å¹¶ä¸”æ’åº
     *
     * @param nums
     * @param left
     * @param right
     * @param temp
     * @return
     */
    private int reversePairs(int[] nums, int left, int right, int[] temp) {
        if (left == right) {
            return 0;
        }

        int mid = left + (right - left) / 2;
        int leftPairs = reversePairs(nums, left, mid, temp);
        int rightPairs = reversePairs(nums, mid + 1, right, temp);

        // å¦‚æœæ•´ä¸ªæ•°ç»„å·²ç»æœ‰åºï¼Œåˆ™æ— éœ€åˆå¹¶ï¼Œæ³¨æ„è¿™é‡Œä½¿ç”¨å°äºç­‰äº
        if (nums[mid] <= nums[mid + 1]) {
            return leftPairs + rightPairs;
        }

        int crossPairs = mergeAndCount(nums, left, mid, right, temp);
        return leftPairs + rightPairs + crossPairs;
    }

    /**
     * nums[left..mid] æœ‰åºï¼Œnums[mid + 1..right] æœ‰åº
     *
     * @param nums
     * @param left
     * @param mid
     * @param right
     * @param temp
     * @return
     */
    private int mergeAndCount(int[] nums, int left, int mid, int right, int[] temp) {
        for (int i = left; i <= right; i++) {
            temp[i] = nums[i];
        }

        int i = left;
        int j = mid + 1;

        int count = 0;
        for (int k = left; k <= right; k++) {
            // æœ‰ä¸‹æ ‡è®¿é—®ï¼Œå¾—å…ˆåˆ¤æ–­æ˜¯å¦è¶Šç•Œ
            if (i == mid + 1) {
                nums[k] = temp[j];
                j++;
            } else if (j == right + 1) {
                nums[k] = temp[i];
                i++;
            } else if (temp[i] <= temp[j]) {
                // æ³¨æ„ï¼šè¿™é‡Œæ˜¯ <= ï¼Œå†™æˆ < å°±ä¸å¯¹ï¼Œè¯·æ€è€ƒåŸå› 
                nums[k] = temp[i];
                i++;
            } else {
                nums[k] = temp[j];
                j++;

                // åœ¨ j æŒ‡å‘çš„å…ƒç´ å½’å¹¶å›å»çš„æ—¶å€™ï¼Œè®¡ç®—é€†åºå¯¹çš„ä¸ªæ•°ï¼Œåªå¤šäº†è¿™ä¸€è¡Œä»£ç 
                count += (mid - i + 1);
            }
        }
        return count;
    }
}
```

Python ä»£ç ï¼š

python

```python
class Solution(object):
    def inversePairs1(self, nums):
        l = len(nums)
        if l < 2:
            return 0
        res = 0
        for i in range(0, l - 1):
            for j in range(i + 1, l):
                if nums[i] > nums[j]:
                    res += 1
        return res

    def inversePairs(self, nums):
        """
        :type nums: List[int]
        :rtype: int
        """

        l = len(nums)
        if l < 2:
            return 0
        temp = [0 for _ in range(l)]
        return self.count_inversion_pairs(nums, 0, l - 1, temp)

    def count_inversion_pairs(self, nums, l, r, temp):
        """
        åœ¨æ•°ç»„ nums çš„åŒºé—´ [l,r] ç»Ÿè®¡é€†åºå¯¹
        :param nums:
        :param l: å¾…ç»Ÿè®¡æ•°ç»„çš„å·¦è¾¹ç•Œï¼Œå¯ä»¥å–åˆ°
        :param r: å¾…ç»Ÿè®¡æ•°ç»„çš„å³è¾¹ç•Œï¼Œå¯ä»¥å–åˆ°
        :param temp:
        :return:
        """
        # æç«¯æƒ…å†µä¸‹ï¼Œå°±æ˜¯åªæœ‰ 1 ä¸ªå…ƒç´ çš„æ—¶å€™
        if l == r:
            return 0
        mid = l + (r - l) // 2
        left_pairs = self.count_inversion_pairs(nums, l, mid, temp)
        right_pairs = self.count_inversion_pairs(nums, mid + 1, r, temp)

        merge_pairs = 0
        # ä»£ç èµ°åˆ°è¿™é‡Œçš„æ—¶å€™ï¼Œ
        # [l, mid] å·²ç»å®Œæˆäº†æ’åºå¹¶ä¸”è®¡ç®—å¥½é€†åºå¯¹
        # [mid + 1, r] å·²ç»å®Œæˆäº†æ’åºå¹¶ä¸”è®¡ç®—å¥½é€†åºå¯¹
        # å¦‚æœ nums[mid] <= nums[mid + 1]ï¼Œæ­¤æ—¶å°±ä¸å­˜åœ¨é€†åºå¯¹
        # å½“ nums[mid] > nums[mid + 1] çš„æ—¶å€™ï¼Œå°±è¦ç»§ç»­è®¡ç®—é€†åºå¯¹
        if nums[mid] > nums[mid + 1]:
            # åœ¨å½’å¹¶çš„è¿‡ç¨‹ä¸­è®¡ç®—é€†åºå¯¹
            merge_pairs = self.merge_and_count(nums, l, mid, r, temp)
        # èµ°åˆ°è¿™é‡Œæœ‰ nums[mid] <= nums[mid + 1] æˆç«‹ï¼Œå·²ç»æ˜¯é¡ºåºç»“æ„
        return left_pairs + right_pairs + merge_pairs

    def merge_and_count(self, nums, l, mid, r, temp):
        """
        å‰ï¼š[2,3,5,8]ï¼Œåï¼š[4,6,7,12]
        æˆ‘ä»¬åªéœ€è¦åœ¨åé¢æ•°ç»„å…ƒç´ å‡ºåˆ—çš„æ—¶å€™ï¼Œæ•°ä¸€æ•°å‰é¢è¿™ä¸ªæ•°ç»„è¿˜å‰©ä¸‹å¤šå°‘ä¸ªæ•°å­—ï¼Œ
        å› ä¸º"å‰"æ•°ç»„å’Œ"å"æ•°ç»„éƒ½æœ‰åºï¼Œ
        å› æ­¤ï¼Œ"å‰"æ•°ç»„å‰©ä¸‹çš„å…ƒç´ ä¸ªæ•° mid - i + 1 å°±æ˜¯ä¸"å"æ•°ç»„å…ƒç´ å‡ºåˆ—çš„è¿™ä¸ªå…ƒç´ æ„æˆçš„é€†åºå¯¹ä¸ªæ•°

        """
        for i in range(l, r + 1):
            temp[i] = nums[i]
        i = l
        j = mid + 1
        res = 0
        for k in range(l, r + 1):
            if i > mid:
                nums[k] = temp[j]
                j += 1
            elif j > r:
                nums[k] = temp[i]
                i += 1
            elif temp[i] <= temp[j]:
                # ä¸ç»Ÿè®¡é€†åºå¯¹ï¼Œåªåšæ’åº
                nums[k] = temp[i]
                i += 1
            else:
                assert temp[i] > temp[j]
                nums[k] = temp[j]
                j += 1
                # å¿«å°±å¿«åœ¨è¿™é‡Œï¼Œä¸€æ¬¡å¯ä»¥æ•°å‡ºä¸€ä¸ªåŒºé—´çš„ä¸ªæ•°çš„é€†åºå¯¹
                # ä¾‹ï¼š[7,8,9][4,6,9]ï¼Œ4 ä¸ 7 ä»¥åŠ 7 å‰é¢æ‰€æœ‰çš„æ•°éƒ½æ„æˆé€†åºå¯¹
                res += (mid - i + 1)
        return res
```

è¯´æ˜ï¼šå½’å¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦å€ŸåŠ©é¢å¤–çš„è¾…åŠ©ç©ºé—´ï¼Œä¸ºæ­¤å¯ä»¥å…¨å±€ä½¿ç”¨ä¸€ä¸ªå’ŒåŸå§‹æ•°ç»„ç­‰é•¿çš„è¾…åŠ©æ•°ç»„ï¼Œå¦åˆ™æ¯ä¸€æ¬¡è¿›å…¥ `merge` å‡½æ•°éƒ½è¦ new æ–°æ•°ç»„ï¼Œå¼€é”€å¾ˆå¤§ã€‚

ä¸Šè¿°è§£æ³•çš„ç¼ºç‚¹æ˜¯ä¿®æ”¹äº†åŸå§‹æ•°ç»„ï¼Œæ’åºå®Œæˆä»¥åï¼Œé€†åºæ•°å°±è®¡ç®—å‡ºæ¥äº†ã€‚ä¸ºæ­¤ï¼š1ã€æˆ‘ä»¬å¯ä»¥å¼•å…¥ä¸€ä¸ªç´¢å¼•æ•°ç»„ï¼›2ã€æˆ–è€…ç›´æ¥æ‹·è´ä¸€ä¸ªåŸå§‹æ•°ç»„ï¼Œè¿™æ ·å°±ä¸ç”¨ä¿®æ”¹åŸå§‹æ•°ç»„äº†ã€‚

### ä¾‹2ï¼šã€ŒåŠ›æ‰£ã€ç¬¬ 315 é¢˜ï¼šè®¡ç®—å³ä¾§å°äºå½“å‰å…ƒç´ çš„ä¸ªæ•°

ä¼ é€é—¨ï¼š[315. è®¡ç®—å³ä¾§å°äºå½“å‰å…ƒç´ çš„ä¸ªæ•°](https://leetcode-cn.com/problems/count-of-smaller-numbers-after-self/)ã€‚

> ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ *nums\*ï¼ŒæŒ‰è¦æ±‚è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ \*counts\*ã€‚æ•°ç»„ \*counts* æœ‰è¯¥æ€§è´¨ï¼š `counts[i]` çš„å€¼æ˜¯ `nums[i]` å³ä¾§å°äº `nums[i]` çš„å…ƒç´ çš„æ•°é‡ã€‚
>
> **ç¤ºä¾‹:**
>
> ```
> è¾“å…¥: [5,2,6,1]
> è¾“å‡º: [2,1,1,0] 
> è§£é‡Š:
> 5 çš„å³ä¾§æœ‰ 2 ä¸ªæ›´å°çš„å…ƒç´  (2 å’Œ 1).
> 2 çš„å³ä¾§ä»…æœ‰ 1 ä¸ªæ›´å°çš„å…ƒç´  (1).
> 6 çš„å³ä¾§æœ‰ 1 ä¸ªæ›´å°çš„å…ƒç´  (1).
> 1 çš„å³ä¾§æœ‰ 0 ä¸ªæ›´å°çš„å…ƒç´ .
> ```

Java ä»£ç ï¼š

java

```java
import java.util.ArrayList;
import java.util.List;

public class Solution {

    private int[] temp;
    private int[] counter;
    private int[] indexes;

    public List<Integer> countSmaller(int[] nums) {
        List<Integer> res = new ArrayList<>();
        int len = nums.length;
        if (len == 0) {
            return res;
        }
        temp = new int[len];
        counter = new int[len];
        indexes = new int[len];
        for (int i = 0; i < len; i++) {
            indexes[i] = i;
        }
        mergeAndCountSmaller(nums, 0, len - 1);
        for (int i = 0; i < len; i++) {
            res.add(counter[i]);
        }
        return res;
    }

    /**
     * é’ˆå¯¹æ•°ç»„ nums æŒ‡å®šçš„åŒºé—´ [l, r] è¿›è¡Œå½’å¹¶æ’åºï¼Œåœ¨æ’åºçš„è¿‡ç¨‹ä¸­å®Œæˆç»Ÿè®¡ä»»åŠ¡
     *
     * @param nums
     * @param l
     * @param r
     */
    private void mergeAndCountSmaller(int[] nums, int l, int r) {
        if (l == r) {
            // æ•°ç»„åªæœ‰ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œæ²¡æœ‰æ¯”è¾ƒï¼Œä¸ç»Ÿè®¡
            return;
        }
        int mid = l + (r - l) / 2;
        mergeAndCountSmaller(nums, l, mid);
        mergeAndCountSmaller(nums, mid + 1, r);
        // å½’å¹¶æ’åºçš„ä¼˜åŒ–ï¼ŒåŒæ ·é€‚ç”¨äºè¯¥é—®é¢˜
        // å¦‚æœç´¢å¼•æ•°ç»„æœ‰åºï¼Œå°±æ²¡æœ‰å¿…è¦å†ç»§ç»­è®¡ç®—äº†
        if (nums[indexes[mid]] > nums[indexes[mid + 1]]) {
            mergeOfTwoSortedArrAndCountSmaller(nums, l, mid, r);
        }
    }

    /**
     * [l, mid] æ˜¯æ’å¥½åºçš„
     * [mid + 1, r] æ˜¯æ’å¥½åºçš„
     *
     * @param nums
     * @param l
     * @param mid
     * @param r
     */
    private void mergeOfTwoSortedArrAndCountSmaller(int[] nums, int l, int mid, int r) {
        // 3,4  1,2
        for (int i = l; i <= r; i++) {
            temp[i] = indexes[i];
        }
        int i = l;
        int j = mid + 1;
        // å·¦è¾¹å‡ºåˆ—çš„æ—¶å€™ï¼Œè®¡æ•°
        for (int k = l; k <= r; k++) {
            if (i > mid) {
                indexes[k] = temp[j];
                j++;
            } else if (j > r) {
                indexes[k] = temp[i];
                i++;
                // æ­¤æ—¶ j ç”¨å®Œäº†ï¼Œ[7,8,9 | 1,2,3]
                // ä¹‹å‰çš„æ•°å°±å’Œåé¢çš„åŒºé—´é•¿åº¦æ„æˆé€†åº
                counter[indexes[k]] += (r - mid);
            } else if (nums[temp[i]] <= nums[temp[j]]) {
                indexes[k] = temp[i];
                i++;
                // æ­¤æ—¶ [4,5, 6   | 1,2,3 10 12 13]
                //           mid          j
                counter[indexes[k]] += (j - mid - 1);
            } else {
                // nums[indexes[i]] > nums[indexes[j]] æ„æˆé€†åº
                indexes[k] = temp[j];
                j++;
            }
        }
    }

    public static void main(String[] args) {
        int[] nums = new int[]{5, 2, 6, 1};
        Solution solution = new Solution();
        List<Integer> countSmaller = solution.countSmaller(nums);
        System.out.println(countSmaller);
    }
}
```

Python ä»£ç ï¼š

python

```python
class Solution:
    def countSmaller(self, nums):
        """
        :type nums: List[int]
        :rtype: List[int]
        """

        size = len(nums)
        if size == 0:
            return []
        if size == 1:
            return [0]

        temp = [None for _ in range(size)]
        indexes = [i for i in range(size)]
        res = [0 for _ in range(size)]

        self.__helper(nums, 0, size - 1, temp, indexes, res)
        return res

    def __helper(self, nums, left, right, temp, indexes, res):
        if left == right:
            return
        mid = left + (right - left) // 2

        # è®¡ç®—ä¸€ä¸‹å·¦è¾¹
        self.__helper(nums, left, mid, temp, indexes, res)
        # è®¡ç®—ä¸€ä¸‹å³è¾¹
        self.__helper(nums, mid + 1, right, temp, indexes, res)

        if nums[indexes[mid]] <= nums[indexes[mid + 1]]:
            return
        self.__sort_and_count_smaller(nums, left, mid, right, temp, indexes, res)

    def __sort_and_count_smaller(self, nums, left, mid, right, temp, indexes, res):
        # [left,mid] å‰æœ‰åºæ•°ç»„
        # [mid+1,right] åæœ‰åºæ•°ç»„

        # å…ˆæ‹·è´ï¼Œå†åˆå¹¶

        for i in range(left, right + 1):
            temp[i] = indexes[i]

        l = left
        r = mid + 1
        for i in range(left, right + 1):
            if l > mid:
                # l ç”¨å®Œï¼Œå°±æ‹¼å‘½ä½¿ç”¨ r
                # [1,2,3,4] [5,6,7,8]
                indexes[i] = temp[r]
                r += 1
            elif r > right:
                # r ç”¨å®Œï¼Œå°±æ‹¼å‘½ä½¿ç”¨ l
                # [6,7,8,9] [1,2,3,4]
                indexes[i] = temp[l]
                l += 1
                # æ³¨æ„ï¼šæ­¤æ—¶å‰é¢å‰©ä¸‹çš„æ•°ï¼Œæ¯”åé¢æ‰€æœ‰çš„æ•°éƒ½å¤§
                res[indexes[i]] += (right - mid)
            elif nums[temp[l]] <= nums[temp[r]]:
                # [3,5,7,9] [4,6,8,10]
                indexes[i] = temp[l]
                l += 1
                # æ³¨æ„ï¼š
                res[indexes[i]] += (r - mid - 1)
            else:
                assert nums[temp[l]] > nums[temp[r]]
                # ä¸Šé¢ä¸¤ç§æƒ…å†µåªåœ¨å…¶ä¸­ä¸€ç§ç»Ÿè®¡å°±å¯ä»¥äº†
                # [3,5,7,9] [4,6,8,10]
                indexes[i] = temp[r]
                r += 1
```

è¯´æ˜ï¼šè¿™é‡Œç”¨åˆ°äº†ä¸€ä¸ªç´¢å¼•æ•°ç»„ `indeses`ï¼Œæ˜¯ä¸€ä¸ªå¸¸è§çš„æŠ€å·§ã€‚æ¯”å¦‚æˆ‘ä»¬äº¤æ¢æ•°ç»„çš„å…ƒç´ æˆæœ¬å¾ˆå¤§çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ç´¢å¼•æ•°ç»„ï¼Œäº¤æ¢ç´¢å¼•æˆæœ¬å¾ˆä½ã€‚è¿™ä¸€ç‚¹ï¼Œåœ¨æˆ‘ä»¬ä»¥åä»‹ç»ç´¢å¼•å †çš„æ—¶å€™è¿˜ä¼šç”¨åˆ°ã€‚

### ä¾‹3ï¼šã€ŒåŠ›æ‰£ã€ç¬¬ 53 é¢˜ï¼šæœ€å¤§å­åºå’Œ

- ä¸­æ–‡ç½‘å€ï¼š[53. æœ€å¤§å­åºå’Œ](https://leetcode-cn.com/problems/maximum-subarray/description/) ï¼›
- è‹±æ–‡ç½‘å€ï¼š[53. Maximum Subarray](https://leetcode.com/problems/maximum-subarray/description/) ï¼›
- é¢˜è§£é“¾æ¥ï¼š[åŠ¨æ€è§„åˆ’ã€åˆ†æ²»æ³•](https://leetcode-cn.com/problems/maximum-subarray/solution/dong-tai-gui-hua-fen-zhi-fa-python-dai-ma-java-dai/)ã€‚

> ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums` ï¼Œæ‰¾åˆ°ä¸€ä¸ªå…·æœ‰æœ€å¤§å’Œçš„è¿ç»­å­æ•°ç»„ï¼ˆå­æ•°ç»„æœ€å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¿”å›å…¶æœ€å¤§å’Œã€‚
>
> **ç¤ºä¾‹:**
>
> ```
> è¾“å…¥: [-2,1,-3,4,-1,2,1,-5,4],
> è¾“å‡º: 6
> è§£é‡Š: è¿ç»­å­æ•°ç»„ [4,-1,2,1] çš„å’Œæœ€å¤§ï¼Œä¸º 6ã€‚
> ```
>
> **è¿›é˜¶:**
>
> å¦‚æœä½ å·²ç»å®ç°å¤æ‚åº¦ä¸º O(*n*) çš„è§£æ³•ï¼Œå°è¯•ä½¿ç”¨æ›´ä¸ºç²¾å¦™çš„åˆ†æ²»æ³•æ±‚è§£ã€‚

åˆ†æï¼šè¿™é“é¢˜å…¶å®æœ€å…ˆåº”è¯¥æƒ³åˆ°ä½¿ç”¨åŠ¨æ€è§„åˆ’ï¼Œä½¿ç”¨åˆ†æ²»æœ‰ç‚¹â€œå°é¢˜å¤§ä½œâ€ï¼Œæˆ‘ä»¬ä¸å¦¨æŠŠåˆ†æ²»è§£æ³•çœ‹åšä¸€ä¸ªä¾‹é¢˜ã€‚

åˆ†æ²»çš„æ—¶å€™ï¼Œè¦æ³¨æ„ä¸€ç‚¹ï¼Œä¸é‡ä¸æ¼ã€‚

Python ä»£ç ï¼š

python

```python
class Solution(object):
    def maxSubArray(self, nums):
        """
        :type nums: List[int]
        :rtype: int
        """
        n = len(nums)
        if n == 0:
            return 0
        return self.__max_sub_array(nums, 0, n - 1)

    def __max_sub_array(self, nums, left, right):
        if left == right:
            return nums[left]
        mid = left + (right - left) // 2
        return max(self.__max_sub_array(nums, left, mid),
                   self.__max_sub_array(nums, mid + 1, right),
                   self.__max_cross_array(nums, left, mid, right))

    def __max_cross_array(self, nums, left, mid, right):
        """
        ä¸€å®šåŒ…å« nums[mid] å…ƒç´ çš„æœ€å¤§è¿ç»­å­æ•°ç»„çš„å’Œ
        æ€è·¯æ˜¯çœ‹çœ‹å·¦è¾¹æ‰©æ•£åˆ°åº•ï¼Œå¾—åˆ°ä¸€ä¸ªæœ€å¤§æ•°
        å³è¾¹æ‰©æ•£åˆ°åº•å¾—åˆ°ä¸€ä¸ªæœ€å¤§æ•°
        :param nums:
        :param mid:
        :param right:
        :return:
        """
        ls = 0
        j = mid - 1
        s1 = 0
        while j >= left:
            s1 += nums[j]
            ls = max(ls, s1)
            j -= 1

        rs = 0
        j = mid + 1
        s2 = 0
        while j <= right:
            s2 += nums[j]
            rs = max(rs, s2)
            j += 1

        return ls + nums[mid] + rs


if __name__ == '__main__':
    s = Solution()
    nums = [-2, 1, -3, 4, -1, 2, 1, -5, 4]
    result = s.maxSubArray(nums)
    print(result)
```

ï¼ˆæœ¬èŠ‚å®Œï¼‰