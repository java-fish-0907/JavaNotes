- [é“¾æ¥](https://leetcode-cn.com/problems/largest-rectangle-in-histogram/)
- [é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/largest-rectangle-in-histogram/solution/bao-li-jie-fa-zhan-by-liweiwei1419/)

> åº”è¯¥å…ˆç†è§£æš´åŠ›è§£æ³•ï¼Œç„¶åç”»å›¾ï¼Œå»ç†è§£å•è°ƒæ ˆæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

### é¢˜ç›®æè¿°

> ç»™å®š `n` ä¸ªéè´Ÿæ•´æ•°ï¼Œç”¨æ¥è¡¨ç¤ºæŸ±çŠ¶å›¾ä¸­å„ä¸ªæŸ±å­çš„é«˜åº¦ã€‚æ¯ä¸ªæŸ±å­å½¼æ­¤ç›¸é‚»ï¼Œä¸”å®½åº¦ä¸º 11 ã€‚
>
> æ±‚åœ¨è¯¥æŸ±çŠ¶å›¾ä¸­ï¼Œèƒ½å¤Ÿå‹¾å‹’å‡ºæ¥çš„çŸ©å½¢çš„æœ€å¤§é¢ç§¯ã€‚
>
> 
>
> ![img](https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2018/10/12/histogram.png)
>
> **img**
>
> 
>
> ä»¥ä¸Šæ˜¯æŸ±çŠ¶å›¾çš„ç¤ºä¾‹ï¼Œå…¶ä¸­æ¯ä¸ªæŸ±å­çš„å®½åº¦ä¸º 1ï¼Œç»™å®šçš„é«˜åº¦ä¸º `[2, 1, 5, 6, 2, 3]`ã€‚
>
> 
>
> ![img](https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2018/10/12/histogram_area.png)
>
> **img**
>
> 
>
> å›¾ä¸­é˜´å½±éƒ¨åˆ†ä¸ºæ‰€èƒ½å‹¾å‹’å‡ºçš„æœ€å¤§çŸ©å½¢é¢ç§¯ï¼Œå…¶é¢ç§¯ä¸º `10` ä¸ªå•ä½ã€‚
>
> **ç¤ºä¾‹**ï¼š
>
> ```
> è¾“å…¥: [2,1,5,6,2,3]
> è¾“å‡º: 10
> ```

### æ–¹æ³•ä¸€ï¼šæš´åŠ›è§£æ³•

> æšä¸¾çŸ©å½¢çš„ä¸Šè¾¹ç•Œä¸ºæ•´ä¸ªè¾¹ç•Œï¼Œç„¶åæ±‚æœ€å¤§å€¼ã€‚
>
> 1ã€å·¦è¾¹çœ‹ä¸€ä¸‹ï¼Œæœ€å¤šèƒ½å»¶ä¼¸å¤šé•¿ï¼›å°äºç­‰äºå®ƒçš„ï¼Œç¬¬ 1 ä¸ªå…ƒç´ çš„ä½ç½®ï¼›
>
> 2ã€å³è¾¹çœ‹ä¸€ä¸‹ï¼Œæœ€å¤šèƒ½å»¶ä¼¸å¤šé•¿ï¼›å¤§äºç­‰äºå®ƒçš„ï¼Œç¬¬ 1 ä¸ªå…ƒç´ çš„ä½ç½®ï¼›
>
> å·¦å³æ˜¯å¯¹ç§°çš„ã€‚

> 1ã€çœ‹å®šä¹‰ï¼Œå°±æ˜¯å•è°ƒæ ˆçš„ç»å…¸æ“ä½œã€‚
>
> 2ã€å’ŒåŒæŒ‡é’ˆçš„æ€è·¯æ˜¯ä¸€æ ·çš„ï¼Œé¦–å…ˆæƒ³ä¸€ä¸‹æš´åŠ›æ€ä¹ˆå†™ã€‚

Java ä»£ç ï¼š

java

```java
public class Solution {

    public int largestRectangleArea(int[] heights) {
        int len = heights.length;
        // ç‰¹åˆ¤
        if (len == 0) {
            return 0;
        }

        int res = 0;
        for (int i = 0; i < len; i++) {
            int left = i;
            int right = i;

            // æ‰¾å·¦è¾¹ç¬¬ 1 ä¸ªä¸¥æ ¼å°äº heights[i] çš„ç´¢å¼•
            while (left > 0 && heights[left - 1] >= heights[i]) {
                left--;
            }
            // æ‰¾å³è¾¹ç¬¬ 1 ä¸ªä¸¥æ ¼å°äº heights[i] çš„ç´¢å¼•
            while (right < len - 1 && heights[right + 1] >= heights[i]) {
                right++;
            }

            // System.out.println("å·¦ï¼š" + left + "ï¼Œå³ï¼š"+ right + "ï¼Œé«˜ï¼š"+ heights[i]);
            int width = right - left + 1;
            res = Math.max(res, width * heights[i]);
        }
        return res;
    }
}
```

### æ–¹æ³•äºŒï¼šå•è°ƒæ ˆ

> æ³¨æ„äº‹é¡¹ï¼š
>
> 1ã€ç”»å›¾ï¼ŒåŠ¨æ€åˆ†æï¼Œæ ˆæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼›
>
> 2ã€éå†çš„æ—¶å€™ï¼Œå½“å‰è¯•å›¾æ·»åŠ è¿›æ ˆçš„æŸ±å½¢é«˜åº¦**ä¸¥æ ¼å°äº**æ ˆé¡¶çš„æŸ±å½¢çš„é«˜åº¦çš„æ—¶å€™ï¼Œæ ˆé¡¶çš„æŸ±å½¢é¢ç§¯å¯ä»¥ç¡®å®šï¼Œæ‰€ä»¥å¼¹å‡ºã€‚
>
> - å› ä¸ºå€¼å¯ä»¥ç¡®å®šï¼Œæ‰€ä»¥å¼¹å‡ºï¼›
> - è®¡ç®—é¢ç§¯çš„æ—¶å€™ï¼Œé«˜åº¦æ˜¯åˆšåˆšå¼¹å‡ºçš„æŸ±å½¢çš„é«˜åº¦ï¼Œå®½åº¦æ˜¯æŸ±å½¢çš„å·¦è¾¹å’Œå³è¾¹ï¼Œå·¦è¾¹æ˜¯å¼¹å‡ºä»¥åçš„æ ˆé¡¶ç´¢å¼•ï¼Œå³è¾¹å°±æ˜¯ç›®å‰è§†å›¾æ·»åŠ è¿›æ ˆçš„ç´¢å¼•ï¼Œå› æ­¤æ˜¯ `(i - stack.peek() - 1)`ï¼›å¦‚æœæ­¤æ—¶æ ˆä¸ºç©ºï¼Œè¯´æ˜ï¼Œåˆšåˆšå¼¹å‡ºçš„æ˜¯ç›®å‰çœ‹åˆ°çš„æœ€å°å…ƒç´ ï¼Œå®ƒæ‰€ç¡®å®šçš„é¢ç§¯çš„å®½åº¦å°±æ˜¯ `i`
>
> 3ã€æœ€åä¸è¦å¿˜è®°æŠŠæ ˆæ¸…ç©ºä¸€ä¸‹ã€‚
>
> - è¿™ä¸€æ­¥å¯ä»¥åŠ ä¸Šä¸€ä¸ªå“¨å…µï¼Œå› ä¸ºè¿™ä¸ªæ ˆçš„ç‰¹ç‚¹æ˜¯å•è°ƒä¸å‡æ ˆï¼Œå› æ­¤ï¼Œå“¨å…µå…ƒç´ è®¾ç½®ä¸º 00 å³å¯ã€‚

ç‚¹å‡»ï¼š[é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/largest-rectangle-in-histogram/solution/bao-li-jie-fa-zhan-by-liweiwei1419/) æœ‰æ›´è¯¦ç»†çš„ä»‹ç»ã€‚

- ä¸ä½¿ç”¨å“¨å…µçš„å†™æ³•

Java ä»£ç ï¼š

java

```java
import java.util.Stack;

public class Solution {

    public int largestRectangleArea(int[] heights) {
        int len = heights.length;
        // ç‰¹åˆ¤
        if (len == 0) {
            return 0;
        }

        Stack<Integer> stack = new Stack<>();
        int res = 0;

        for (int i = 0; i < len; i++) {
            while (!stack.isEmpty() && heights[stack.peek()] > heights[i]) {
                // top æ‰€åœ¨çš„æŸ±å½¢çš„æœ€å¤§é«˜åº¦å¯ä»¥ç¡®å®š
                int top = stack.pop();
                int width;

                if (stack.isEmpty()) {
                    width = i;
                } else {
                    width = i - stack.peek() - 1;
                }

                res = Math.max(res, heights[top] * width);
            }
            stack.push(i);
        }

        // æ³¨æ„ï¼šå¦‚æœæ ˆé‡Œæœ‰å…ƒç´ ï¼Œéœ€è¦æ¸…ç©º
        while (!stack.isEmpty()) {
            // top æ‰€åœ¨çš„æŸ±å½¢çš„æœ€å¤§é«˜åº¦å¯ä»¥ç¡®å®š
            int top = stack.pop();
            int width;

            if (stack.isEmpty()) {
                width = len;
            } else {
                width = len - stack.peek() - 1;
            }

            res = Math.max(res, heights[top] * width);
        }
        return res;
    }
}
```

- ä½¿ç”¨å“¨å…µçš„å†™æ³•

Java ä»£ç ï¼š

java

```java
import java.util.Stack;

public class Solution {

    public int largestRectangleArea(int[] heights) {
        int len = heights.length;
        // ç‰¹åˆ¤
        if (len == 0) {
            return 0;
        }

        // æœ€åä¸€ä¸ª 0 ç±»ä¼¼äºå“¨å…µï¼Œä¸ºäº†å°†æ ˆä¸­çš„å…ƒç´ å…¨éƒ¨æ¸…ç©º
        int[] newHeights = new int[len + 1];
        System.arraycopy(heights, 0, newHeights, 0, len);
        newHeights[len] = 0;

        // æ³¨æ„ï¼šä¸ºäº†é¿å…ç¼–ç å‡ºé”™ï¼Œå°† heights æŒ‡å‘æ–°çš„ newHeights
        heights = newHeights;

        Stack<Integer> stack = new Stack<>();
        int res = 0;

        // æ³¨æ„ï¼šfor å¾ªç¯é‡Œé¢æ˜¯å°äºç­‰äºï¼Œå³ i <= len
        for (int i = 0; i <= len; i++) {
            while (!stack.isEmpty() && heights[stack.peek()] > heights[i]) {
                // top æ‰€åœ¨çš„æŸ±å½¢çš„æœ€å¤§é«˜åº¦å¯ä»¥ç¡®å®š
                int top = stack.pop();
                int width;

                if (stack.isEmpty()) {
                    width = i;
                } else {
                    width = i - stack.peek() - 1;
                }

                res = Math.max(res, heights[top] * width);
            }
            stack.push(i);
        }
        return res;
    }
}
```

------

# ã€ŒåŠ›æ‰£ã€ç¬¬ 84 é¢˜ï¼š[æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢](https://leetcode-cn.com/problems/largest-rectangle-in-histogram/)

> ç»™å®š *n* ä¸ªéè´Ÿæ•´æ•°ï¼Œç”¨æ¥è¡¨ç¤ºæŸ±çŠ¶å›¾ä¸­å„ä¸ªæŸ±å­çš„é«˜åº¦ã€‚æ¯ä¸ªæŸ±å­å½¼æ­¤ç›¸é‚»ï¼Œä¸”å®½åº¦ä¸º 1 ã€‚
>
> æ±‚åœ¨è¯¥æŸ±çŠ¶å›¾ä¸­ï¼Œèƒ½å¤Ÿå‹¾å‹’å‡ºæ¥çš„çŸ©å½¢çš„æœ€å¤§é¢ç§¯ã€‚
>
> **ç¤ºä¾‹ï¼š**
>
> ```
> è¾“å…¥: [2,1,5,6,2,3]
> è¾“å‡º: 10
> ```

### æ–¹æ³•ä¸€ï¼šæš´åŠ›è§£æ³•

è¿™é“é—®é¢˜çš„æš´åŠ›è§£æ³•æ¯”â€œæ¥é›¨æ°´â€é‚£é“é¢˜è¦å…¶å®å¥½æƒ³å¾—å¤šã€‚

æˆ‘ä»¬å¯ä»¥æšä¸¾ä»¥æ¯ä¸ªæŸ±å½¢ä¸ºé«˜åº¦çš„æœ€å¤§çŸ©å½¢çš„é¢ç§¯ã€‚

å…·ä½“æ¥è¯´å°±æ˜¯ï¼šä¾æ¬¡éå†æŸ±å½¢çš„é«˜åº¦ï¼Œå¯¹äºæ¯ä¸€ä¸ªé«˜åº¦åˆ†åˆ«å‘ä¸¤è¾¹æ‰©æ•£ï¼Œæ±‚å‡ºä»¥å½“å‰é«˜åº¦ä¸ºçŸ©å½¢çš„æœ€å¤§å®½åº¦å¤šå°‘ã€‚

ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ã€‚

1. å·¦è¾¹çœ‹ä¸€ä¸‹ï¼Œçœ‹æœ€å¤šèƒ½å‘å·¦å»¶ä¼¸å¤šé•¿ï¼Œæ‰¾åˆ°å¤§äºç­‰äºå½“å‰æŸ±å½¢é«˜åº¦çš„æœ€å·¦è¾¹å…ƒç´ çš„ä¸‹æ ‡ï¼›
2. å³è¾¹çœ‹ä¸€ä¸‹ï¼Œçœ‹æœ€å¤šèƒ½å‘å³å»¶ä¼¸å¤šé•¿ï¼›æ‰¾åˆ°å¤§äºç­‰äºå½“å‰æŸ±å½¢é«˜åº¦çš„æœ€å³è¾¹å…ƒç´ çš„ä¸‹æ ‡ã€‚

å¯¹äºæ¯ä¸€ä¸ªä½ç½®ï¼Œæˆ‘ä»¬éƒ½è¿™æ ·æ“ä½œï¼Œå¾—åˆ°ä¸€ä¸ªçŸ©å½¢é¢ç§¯ï¼Œæ±‚å‡ºå®ƒä»¬çš„æœ€å¤§å€¼ã€‚

Java ä»£ç ï¼š

java

```java
public class Solution {

    public int largestRectangleArea(int[] heights) {
        int len = heights.length;
        // ç‰¹åˆ¤
        if (len == 0) {
            return 0;
        }

        int res = 0;
        for (int i = 0; i < len; i++) {

            // æ‰¾å·¦è¾¹æœ€å 1 ä¸ªå¤§äºç­‰äº heights[i] çš„ä¸‹æ ‡
            int left = i;
            int curHeight = heights[i];
            while (left > 0 && heights[left - 1] >= curHeight) {
                left--;
            }

            // æ‰¾å³è¾¹æœ€å 1 ä¸ªå¤§äºç­‰äº heights[i] çš„ç´¢å¼•
            int right = i;
            while (right < len - 1 && heights[right + 1] >= curHeight) {
                right++;
            }

            int width = right - left + 1;
            res = Math.max(res, width * curHeight);
        }
        return res;
    }
}
```

è¿™æ ·å†™çš„ Python ä»£ç æ˜¯ä¼šè¶…æ—¶çš„ã€‚

Python ä»£ç ï¼šï¼ˆPython ä»£ç ä¼šè¶…æ—¶ï¼‰

python

```python
from typing import List


class Solution:
    def largestRectangleArea(self, heights: List[int]) -> int:
        size = len(heights)
        res = 0

        for i in range(size):
            left = i
            cur_height = heights[i]
            while left > 0 and heights[left - 1] >= cur_height:
                left -= 1

            right = i
            while right < size - 1 and heights[right + 1] >= cur_height:
                right += 1

            max_width = right - left + 1
            res = max(res, max_width * cur_height)
        return res
```

**å¤æ‚åº¦åˆ†æ**ï¼š

- æ—¶é—´å¤æ‚åº¦ï¼šğ‘‚(ğ‘2)O(N2)ï¼›
- ç©ºé—´å¤æ‚åº¦ï¼šğ‘‚(1)O(1)ã€‚

### æ–¹æ³•äºŒï¼šä»¥ç©ºé—´æ¢æ—¶é—´ï¼Œç”¨åˆ°çš„æ•°æ®ç»“æ„æ˜¯æ ˆ

çœ‹åˆ°æ—¶é—´å¤æ‚åº¦ä¸º ğ‘‚(ğ‘2)O(N2) å’Œç©ºé—´å¤æ‚åº¦ä¸º ğ‘‚(1)O(1) çš„ç»„åˆï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥ä¸€æ¬¡éå†ï¼Œä¸éœ€è¦ä¸­å¿ƒæ‰©æ•£å°±èƒ½å¤Ÿè®¡ç®—å‡ºæ¯ä¸€ä¸ªé«˜åº¦æ‰€å¯¹åº”çš„é‚£ä¸ªæœ€å¤§é¢ç§¯çŸ©å½¢çš„é¢ç§¯å‘¢ï¼Ÿ

å…¶å®å¾ˆå®¹æ˜“æƒ³åˆ°çš„ä¼˜åŒ–çš„æ€è·¯å°±æ˜¯â€œä»¥ç©ºé—´æ¢æ—¶é—´â€ã€‚æˆ‘ä»¬éœ€è¦åœ¨éå†çš„è¿‡ç¨‹ä¸­è®°å½•ä¸€äº›ä¿¡æ¯ã€‚

è¦ææ¸…æ¥šè¿™ä¸ªè¿‡ç¨‹ï¼Œè¯·å¤§å®¶ä¸€å®šè¦åœ¨çº¸ä¸Šç”»å›¾ï¼Œææ¸…æ¥šä¸€äº›ç»†èŠ‚ï¼Œè¿™æ ·åœ¨ç¼–ç çš„æ—¶å€™å°±ä¸å®¹æ˜“å‡ºé”™äº†ã€‚

è®°å½•ä»€ä¹ˆä¿¡æ¯å‘¢ï¼Ÿè®°å½•é«˜åº¦æ˜¯ä¸æ˜¯å¯ä»¥å‘¢ï¼Ÿå…¶å®æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºè®¡ç®—çŸ©å½¢è¿˜éœ€è¦è®¡ç®—å®½åº¦ï¼Œå¾ˆå®¹æ˜“çŸ¥é“å®½åº¦æ˜¯æœ‰ä¸‹æ ‡ç¡®å®šçš„ï¼Œè®°å½•äº†ä¸‹æ ‡å…¶å®å¯¹åº”çš„é«˜åº¦å°±å¯ä»¥ç›´æ¥ä»è¾“å…¥æ•°ç»„ä¸­å¾—å‡ºã€‚

æˆ‘ä»¬å°±æ‹¿ç¤ºä¾‹çš„æ•°ç»„ `[2, 1, 5, 6, 2, 3]` ä¸ºä¾‹ï¼š

- ä¸€å¼€å§‹çœ‹åˆ°çš„æŸ±å½¢é«˜åº¦ä¸º `2` ï¼Œè¿™ä¸ªæ—¶å€™ä»¥è¿™ä¸ª `2` ä¸ºé«˜åº¦çš„æœ€å¤§é¢ç§¯çš„çŸ©å½¢æ˜¯ä¸èƒ½ç¡®å®šä¸‹æ¥çš„ï¼Œä¸ºæ­¤æˆ‘ä»¬éœ€è¦ç»§ç»­å‘å³éå†ï¼›
- ç„¶åéå†åˆ°é«˜åº¦ä¸º `1` çš„æŸ±å½¢ï¼Œè¿™ä¸ªæ—¶å€™ä»¥è¿™ä¸ªæŸ±å½¢ä¸ºé«˜åº¦çš„çŸ©å½¢çš„æœ€å¤§é¢ç§¯è¿˜æ˜¯ä¸çŸ¥é“çš„ï¼Œä½†æ˜¯å®ƒä¹‹å‰çš„ä»¥ `2` ä¸ºé«˜åº¦çš„æœ€å¤§é¢ç§¯çš„çŸ©å½¢æ˜¯å¯ä»¥ç¡®å®šçš„ï¼Œè¿™æ˜¯å› ä¸ºè¿™ä¸ª `1` æ¯” `2` å° ï¼Œå› ä¸ºè¿™ä¸ª `1` å¡åœ¨äº†è¿™é‡Œ `2` ä¸èƒ½å†å‘å³è¾¹æ‰©å±•äº†ã€‚æˆ‘ä»¬è®¡ç®—ä¸€ä¸‹ä»¥ `2` ä¸ºé«˜åº¦çš„æœ€å¤§çŸ©å½¢çš„é¢ç§¯ï¼Œå°±æ˜¯ `2`ï¼›è¿™ä¸ªæ—¶å€™ï¼Œæ±‚è§£è¿™ä¸ªé—®é¢˜çš„æ€è·¯å…¶å®å·²ç»æ…¢æ…¢å±•å¼€äº†ï¼›
- éå†åˆ°é«˜åº¦ä¸º `5` çš„æŸ±å½¢ï¼ŒåŒæ ·çš„ä»¥å½“å‰çœ‹åˆ°æŸ±å½¢ä¸ºé«˜åº¦çš„çŸ©å½¢çš„æœ€å¤§é¢ç§¯ä¹Ÿæ˜¯ä¸çŸ¥é“çš„ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜è¦çœ‹å³è¾¹é«˜åº¦çš„æƒ…å†µã€‚é‚£ä¹ˆå®ƒçš„å·¦å³æœ‰æ²¡æœ‰å¯ä»¥ç¡®å®šçš„æŸ±å½¢å‘¢ï¼Ÿæ²¡æœ‰ï¼Œè¿™æ˜¯å› ä¸º `5` æ¯” `1` å¤§ï¼Œæˆ‘ä»¬çœ‹åé¢é©¬ä¸Šå°±å‡ºç°äº† `6`ï¼Œä¸ç®¡æ˜¯ `1` è¿™ä¸ªæŸ±å½¢è¿˜æ˜¯ `5` è¿™ä¸ªæŸ±å½¢ï¼Œéƒ½è¿˜å¯ä»¥å‘å³è¾¹æ‰©å±•ï¼›
- æ¥ä¸‹æ¥ï¼Œéå†åˆ°é«˜åº¦ä¸º `6` çš„æŸ±å½¢ï¼ŒåŒæ ·çš„ï¼Œä»¥æŸ±å½¢ `1`ã€`5`ã€`6` ä¸ºé«˜åº¦çš„æœ€å¤§çŸ©å½¢é¢ç§¯è¿˜æ˜¯ä¸èƒ½ç¡®å®šä¸‹æ¥ï¼›
- å†æ¥ä¸‹æ¥ï¼Œéå†åˆ°é«˜åº¦ä¸º `2` çš„æŸ±å½¢ï¼Œå”‰ï¼Œå‘ç°äº†ä¸€ä»¶å¾ˆç¥å¥‡çš„äº‹æƒ…ï¼ŒæŸ±å½¢ `6`å¯¹åº”çš„æœ€å¤§é¢ç§¯çš„çŸ©å½¢çš„å®½åº¦å¯ä»¥ç¡®å®šä¸‹æ¥ï¼Œå®ƒå°±æ˜¯å¤¹åœ¨ `5` å’Œ `2` ä¹‹é—´çš„è·ç¦»ï¼Œå®ƒçš„é«˜åº¦æ˜¯ `1`ï¼›
- å¹¶ä¸”æŸ±å½¢ `5` å¯¹åº”çš„æœ€å¤§é¢ç§¯çš„çŸ©å½¢çš„å®½åº¦ä¹Ÿå¯ä»¥ç¡®å®šä¸‹æ¥ï¼Œå®ƒæ˜¯å¤¹åœ¨æŸ±å½¢ `1` å’ŒæŸ±å½¢ `2` ä¹‹é—´çš„è·ç¦»ï¼›

> æˆ‘ä»¬å‘ç°äº†ï¼Œåªè¦æ˜¯é‡åˆ°äº†å½“å‰æŸ±å½¢çš„é«˜åº¦æ¯”å®ƒä¸Šä¸€ä¸ªæŸ±å½¢çš„é«˜åº¦ä¸¥æ ¼å°çš„æ—¶å€™ï¼Œä¸€å®šå¯ä»¥ç¡®å®šå®ƒä¹‹å‰çš„æŸäº›æŸ±å½¢çš„æœ€å¤§å®½åº¦ï¼Œå¹¶ä¸”ç¡®å®šçš„æŸ±å½¢å®½åº¦çš„é¡ºåºæ˜¯ä»å³è¾¹å‘å·¦è¾¹ã€‚
>
> è¿™ä¸ªç°è±¡å°±æç¤ºæˆ‘ä»¬ï¼Œæˆ‘ä»¬åœ¨éå†çš„æ—¶å€™éœ€è¦è®°å½•çš„ä¿¡æ¯å°±æ˜¯éå†åˆ°çš„æŸ±å½¢çš„ä¸‹æ ‡ï¼Œå®ƒä¸€å·¦ä¸€å³çš„ä¸¤ä¸ªæŸ±å½¢çš„ä¸‹æ ‡çš„å·®å°±æ˜¯è¿™ä¸ªé¢ç§¯æœ€å¤§çš„çŸ©å½¢å¯¹åº”çš„æœ€å¤§å®½åº¦ã€‚

è¿™ä¸ªæ—¶å€™ï¼Œè¿˜éœ€è¦è€ƒè™‘çš„ä¸€ä¸ªç»†èŠ‚æ˜¯ï¼Œæˆ‘åœ¨ç¡®å®šä¸€ä¸ªæŸ±å½¢çš„é¢ç§¯çš„æ—¶å€™ï¼Œé™¤äº†å³è¾¹è¦æ¯”å½“å‰ä¸¥æ ¼å°ï¼Œå…¶å®è¿˜è•´å«äº†ä¸€ä¸ªæ¡ä»¶ï¼Œé‚£å°±æ˜¯å·¦è¾¹ä¹Ÿè¦æ¯”å½“å‰é«˜åº¦ä¸¥æ ¼å°ã€‚

é‚£å¦‚æœæ˜¯å·¦è¾¹çš„é«˜åº¦å’Œè‡ªå·±ç›¸ç­‰æ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬æƒ³ä¸€æƒ³ï¼Œæˆ‘ä»¬ä¹‹å‰æ˜¯åªè¦æ¯”å½“å‰ä¸¥æ ¼å°ï¼Œæˆ‘ä»¬æ‰å¯ä»¥ç¡®å®šä¸€äº›æŸ±å½¢çš„æœ€å¤§å®½åº¦ã€‚åªè¦æ˜¯å¤§äºæˆ–è€…ç­‰äºä¹‹å‰çœ‹åˆ°çš„é‚£ä¸€ä¸ªæŸ±å½¢çš„é«˜åº¦çš„æ—¶å€™ï¼Œæˆ‘ä»¬å…¶å®éƒ½ä¸èƒ½ç¡®å®šã€‚

å› æ­¤æˆ‘ä»¬ç¡®å®šå½“å‰æŸ±å½¢å¯¹åº”çš„å®½åº¦çš„å·¦è¾¹ç•Œçš„æ—¶å€™ï¼Œå¾€å›å¤´çœ‹çš„æ—¶å€™ï¼Œä¸€å®šè¦æ‰¾åˆ°ç¬¬ä¸€ä¸ªä¸¥æ ¼å°äºæˆ‘ä»¬è¦ç¡®å®šçš„é‚£ä¸ªæŸ±å½¢çš„é«˜åº¦çš„ä¸‹æ ‡ã€‚è¿™ä¸ªæ—¶å€™ ä¸­é—´é‚£äº›ç›¸ç­‰çš„æŸ±å½¢å…¶å®å°±å¯ä»¥å½“åšä¸å­˜åœ¨ä¸€æ ·ã€‚å› ä¸ºå®ƒå¯¹åº”çš„æœ€å¤§çŸ©å½¢å’Œå®ƒå¯¹åº”çš„æœ€å¤§çŸ©å½¢å…¶å®æ˜¯ä¸€æ ·çš„ã€‚

è¯´åˆ°è¿™é‡Œï¼Œå…¶å®æˆ‘ä»¬çš„æ€è·¯å·²ç»æ…¢æ…¢æ¸…æ™°äº†ã€‚

æˆ‘ä»¬åœ¨éå†çš„æ—¶å€™ï¼Œéœ€è¦è®°å½•çš„æ˜¯ä¸‹æ ‡ï¼Œå¦‚æœå½“å‰çš„é«˜åº¦æ¯”å®ƒä¹‹å‰çš„é«˜åº¦ä¸¥æ ¼å°äºçš„æ—¶å€™ï¼Œå°±å¯ä»¥ç›´æ¥ç¡®å®šä¹‹å‰çš„é‚£ä¸ªé«˜çš„æŸ±å½¢çš„æœ€å¤§çŸ©å½¢çš„é¢ç§¯ï¼Œä¸ºäº†ç¡®å®šè¿™ä¸ªæœ€å¤§çŸ©å½¢çš„å·¦è¾¹ç•Œï¼Œæˆ‘ä»¬è¿˜è¦æ‰¾åˆ°ç¬¬ä¸€ä¸ªä¸¥æ ¼å°äºå®ƒçš„é«˜åº¦çš„çŸ©å½¢ï¼Œå‘å·¦å›é€€çš„æ—¶å€™ï¼Œå…¶å®å°±å¯ä»¥å½“ä¸­é—´è¿™äº›æŸ±å½¢ä¸å­˜åœ¨ä¸€æ ·ã€‚

è¿™æ˜¯å› ä¸ºæˆ‘ä»¬å°±æ˜¯æƒ³ç¡®å®š 6 çš„å®½åº¦ï¼Œ6 çš„å®½åº¦ç¡®å®šå®Œäº†ï¼Œå…¶å®æˆ‘ä»¬å°±ä¸éœ€è¦å®ƒäº†ï¼Œè¿™ä¸ª 5 çš„é«˜åº¦å’Œè¿™ä¸ª 5 çš„é«˜åº¦ç¡®å®šå®Œäº†ï¼Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦å®ƒäº†ï¼Œå› æ­¤æˆ‘ä»¬å°±ç›¸å½“äºåªåœ¨ä¸€ä¸ªæ•°æ®ç»“æ„çš„ä¸€ä¾§è¿›è¡Œæ“ä½œï¼Œè¿™ä¸ªæ•°æ®ç»“æ„å°±æ˜¯æ ˆï¼Œå®ƒæ°å¥½ç¬¦åˆæˆ‘ä»¬è¿™ä¸ªé—®é¢˜åè¿›å…ˆå‡ºçš„ç‰¹ç‚¹ã€‚

å½“ç¡®å®šäº†ä¸€ä¸ªæŸ±å½¢çš„é«˜åº¦çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å°†å®ƒä»æ ˆé¡¶ç§»å‡ºï¼Œæ‰€æœ‰çš„æŸ±å½¢åœ¨æ ˆä¸­è¿›æ ˆä¸€æ¬¡ï¼Œå‡ºæ ˆä¸€æ¬¡ï¼Œä¸€å¼€å§‹æ ˆä¸ºç©ºï¼Œæœ€åä¹Ÿä¸€å®šè¦è®©æ ˆä¸ºç©ºï¼Œè¡¨ç¤ºè¿™ä¸ªé«˜åº¦æ•°ç»„é‡Œæ‰€æœ‰çš„å…ƒç´ éƒ½è€ƒè™‘å®Œäº†ã€‚

Java ä»£ç ï¼š

java

```java
import java.util.ArrayDeque;
import java.util.Deque;

public class Solution6 {

    public int largestRectangleArea(int[] heights) {
        int len = heights.length;
        if (len == 0) {
            return 0;
        }

        if (len == 1) {
            return heights[0];
        }

        int res = 0;
        Deque<Integer> stack = new ArrayDeque<>(len);
        for (int i = 0; i < len; i++) {
            // è¿™ä¸ª while å¾ˆå…³é”®
            while (!stack.isEmpty() && heights[i] < heights[stack.peekLast()]) {
                int curHeight = heights[stack.pollLast()];
                while (!stack.isEmpty() && heights[stack.peekLast()] == curHeight) {
                    stack.pollLast();
                }

                int curWidth;
                if (stack.isEmpty()) {
                    curWidth = i;
                } else {
                    curWidth = i - stack.peekLast() - 1;
                }

                // System.out.println("curIndex = " + curIndex + " " + curHeight * curWidth);
                res = Math.max(res, curHeight * curWidth);
            }
            stack.add(i);
        }

        while (!stack.isEmpty()) {
            int curHeight = heights[stack.pollLast()];
            while (!stack.isEmpty() && heights[stack.peekLast()] == curHeight) {
                stack.pollLast();
            }
            int curWidth;
            if (stack.isEmpty()) {
                curWidth = len;
            } else {
                curWidth = len - stack.peekLast() - 1;
            }
            res = Math.max(res, curHeight * curWidth);
        }
        return res;
    }


    public static void main(String[] args) {
        int[] heights = new int[]{2, 1, 5, 6, 2, 3};
        Solution6 solution6 = new Solution6();
        int res = solution6.largestRectangleArea(heights);
        System.out.println(res);
    }
}
```

Java ä»£ç ï¼šåŠ äº†å“¨å…µçš„å†™æ³•ã€‚

java

```java
import java.util.ArrayDeque;
import java.util.Deque;

public class Solution {

    public int largestRectangleArea(int[] heights) {
        int len = heights.length;
        if (len == 0) {
            return 0;
        }

        if (len == 1) {
            return heights[0];
        }

        int res = 0;

        int[] newHeights = new int[len + 2];
        newHeights[0] = 0;
        System.arraycopy(heights, 0, newHeights, 1, len);
        newHeights[len + 1] = 0;
        len += 2;
        heights = newHeights;

        Deque<Integer> stack = new ArrayDeque<>(len);
        for (int i = 0; i < len; i++) {

            while (!stack.isEmpty() && heights[i] < heights[stack.peekLast()]) {
                int curHeight = heights[stack.pollLast()];

                while (!stack.isEmpty() && heights[stack.peekLast()] == curHeight) {
                    stack.pollLast();
                }

                int curWidth = i - stack.peekLast() - 1;
                res = Math.max(res, curHeight * curWidth);
            }
            stack.add(i);
        }
        return res;
    }
}
```

Java ä»£ç ï¼š

java

```java
import java.util.ArrayDeque;
import java.util.Deque;

public class Solution {

    public int largestRectangleArea(int[] heights) {
        int len = heights.length;
        int res = 0;

        int[] newHeights = new int[len + 2];
        newHeights[0] = 0;
        System.arraycopy(heights, 0, newHeights, 1, len);
        newHeights[len + 1] = 0;
        len += 2;
        heights = newHeights;

        Deque<Integer> stack = new ArrayDeque<>(len);
        for (int i = 0; i < len; i++) {

            while (!stack.isEmpty() && heights[i] < heights[stack.peekLast()]) {
                int curHeight = heights[stack.pollLast()];
                int curWidth = i - stack.peekLast() - 1;
                res = Math.max(res, curHeight * curWidth);
            }
            stack.add(i);
        }
        return res;
    }
}
```

**å¤æ‚åº¦åˆ†æ**ï¼š

- æ—¶é—´å¤æ‚åº¦ï¼šğ‘‚(ğ‘)O(N)ï¼Œè¾“å…¥æ•°ç»„é‡Œçš„æ¯ä¸€ä¸ªå…ƒç´ å…¥æ ˆä¸€æ¬¡ï¼Œå‡ºæ ˆä¸€æ¬¡ã€‚
- ç©ºé—´å¤æ‚åº¦ï¼šğ‘‚(ğ‘)O(N)ï¼Œæ ˆçš„ç©ºé—´æœ€å¤šä¸º ğ‘Nã€‚