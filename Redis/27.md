

分区为 Redis 提供了更大的存储能力，更高的性能，更强的传输能力

分区是分割数据到多个 Redis 实例的处理过程

分区后每个 Redis 实例只保存 key 的一个子集

1、 通过利用多台计算机内存，我们可以构造更大的 Redis 数据库
2、 通过多核和多台计算机，我们可以扩展计算能力，提供更高的性能
3、 通过多台计算机和网络适配器，我们可以扩展网络带宽，提供更强的传输能力

Redis 分区也不是万能的，分区后也有一些缺点

1、 涉及多个 key 的操作通常是不被支持的。比如当两个 set 映射到不同的 Redis 实例上时，就不能对这两个 set 执行交集操作
2、 涉及多个 key 的 Redis 事务不能使用
3、 当使用 Redis 分区时，数据处理较为复杂，比如需要处理多个 rdb/aof 文件，并且从多个实例和主机备份持久化文件
4、 增加或删除容量也比较复杂
Redis 集群大多数支持在运行时增加、删除节点的透明数据平衡的能力，但是类似于客户端分区、代理等其他系统则不支持这项特性。
```js 
不过，一种叫做 presharding 的技术对此是有帮助的
```

## 分区类型

Redis 有两种分区： 范围分区和哈希分区

这两个分区系统可以用来映射某个 key 到某个 Redis 服务

假设有 4 个 Redis 实例 R0，R1，R2，R3，和 user:1，user:2 这样的表示用户的多个 key ，对既定的 key 有多种不同方式来选择这个 key 存放在哪个实例中

范围分区是最简单的分区，它可以映射一定范围的对象到特定的 Redis 实例

比如可以把 ID 从 0 到 10000 的用户会保存到实例 R0 ，ID 从 10001 到 20000 的用户会保存到 R1，以此类推

这种方式的不足之处就是要有一个区间范围到实例的映射表

这个表要被管理，同时还需要各种对象的映射表

范围分区对 Redis 来说并非是好的方法

**哈希 ( hash )** 分区是另一种分区方法，是比范围分区更好的分区方法

因为它对任何 key 都适用，键也不需要是 object_name:这种形式

使用哈希分区的流程一般如下

1、 用一个 hash 函数将 key 转换为一个数字，比如使用 crc32 hash 函数
```js 
比如对 键(key) foobar 执行 **crc32(foobar)** 会输出整数 **93024922**
```

2、 对这个整数取模，将其转化为 0-3 之间的数字
3、 将这个整数映射到 4 个 Redis 实例中的一个了

```js 
93024922 % 4 = 2，就是说 key foobar 应该被存到 R2 实例中
```

取模操作是取除的余数，大多数的语言都用 % 操作符实现

